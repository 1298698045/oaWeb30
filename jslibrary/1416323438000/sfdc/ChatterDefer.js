/*
 * This code is for Internal Salesforce use only, and subject to change without notice.
 * Customers shouldn't reference this file in any web pages.
 */
Sfdc.ns("Sfdc.ChatterNotes");
Sfdc.ChatterNotes=function(){var f,g,m,d,e;this.getTitleFieldValue=function(){return Sfdc.get("noteTitle").value};this.init=function(a,b,c,k){var l=this;m=a;g=c;f=this.getTitleFieldValue();d=this.initEditor(g,k);setInterval(function(){l.updateLastSaved()},6E4);var h=window.onbeforeunload;window.onbeforeunload=function(){if(l.checkDirty())return LC.getLabel("ChatterNotesDetailPage","UnsavedEditsWarning");if(h)return h()}};this.initEditor=function(a,b){var c=this;return CKEDITOR.replace(document.querySelector("#editor"),{readOnly:b,
resize_enabled:!1,height:"560px",extraAllowedContent:"p[onclick], li[onclick]",removePlugins:"elementspath, magicline",toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["BulletedList","NumberedList"]}],on:{change:function(a){c.checkDirty()},instanceReady:function(b){this.setData(a,{callback:function(){this.resetDirty();c.checkDirty()}})}}},"")};this.checkDirty=function(){if(!d||!f||!g)return!1;var a=this.getTitleFieldValue(),b=Sfdc.get("#notes-save-button");if(a===f&&!d.checkDirty())return b.value=
LC.getLabel("ChatterNotesDetailPage","Saved"),b.setAttribute("disabled",!0),!1;""===a?b.setAttribute("disabled",!0):(b.value=LC.getLabel("ChatterNotesDetailPage","Save"),b.removeAttribute("disabled"));return!0};this.createNote=function(a){var b=chatter.getToolbox(),c={};c.parentId=a;b.post({url:"/chatternote",params:c,success:function(a,b){var c=Sfdc.Url.generateUrl(UserContext.getUrl("/"+b.docId));navigateToUrl(c)},failure:function(a,b){alert(LC.getLabel("ChatterFilesTabPage","genericErrorMessage"))}})};
this.deleteNote=function(a,b){var c=chatter.getToolbox(),d=LC.getLabel("ChatterNotesDetailPage","deleteConfirmation");return confirm(d)?(c.post({url:"/chatterfile/"+a+";delete",id:a,success:function(){b?b.call(this):navigateToUrl(UserContext.getUrl("/_ui/core/chatter/files/FileTabPage"),null,Desktop.CLOSETAB_ACTION)},failure:function(a,b){failureCallback&&failureCallback.call(this,a,b)}}),!0):!1};this.saveNote=function(){var a=getTitleFieldValue(),b=d.getData(),c=Sfdc.get("#notes-save-button");c.value=
LC.getLabel("ChatterNotesDetailPage","Saving");c.setAttribute("disabled",!0);var k=this;chatter.getToolbox().post({url:"/chatternote/"+m+";edit",params:{content:b,title:a},success:function(l,h){var n=Sfdc.get(".chatterFileDetailLeftPanel .userInfoPanel .lastModifiedAt");e=new Date;n.innerHTML=LC.getLabel("ChatterNotesDetailPage","LastModifiedTodayAt",Sfdc.Date.formatDate(e,"h:mm a"));c.value=LC.getLabel("ChatterNotesDetailPage","Saved");f=a;g=b;contentVersionId=h.verId;document.title=LC.getLabel("ChatterFileDetailPage",
"file")+": "+trim(a)+document.title.substring(document.title.lastIndexOf(" ~ "));d.resetDirty();k.updateLastSaved()},failure:function(a,b){var d=Sfdc.get("#notes-save-container span");Sfdc.Dom.setText(d,LC.getLabel("ChatterNotesDetailPage","SaveFailed"));Sfdc.Dom.addClass(d,"error");c.value=LC.getLabel("ChatterNotesDetailPage","Save");c.removeAttribute("disabled");e=null}})};this.updateLastSaved=function(){var a=Sfdc.get("#notes-save-container span");e&&Sfdc.Dom.setText(a,LC.getLabel("ChatterNotesDetailPage",
"SavedAt",Sfdc.Date.getDateTimeStringFromUserLocale(e)))};return this}();
AccessibleAutoCompleteInputElement=function(a,b,c,d,e,g,f){AutoCompleteInputElement.apply(this,[a,b,c,d,!0,e,g,f]);this.groupedSuggestions=null;null!==this.element&&(this.element.setAttribute("role","combobox"),this.element.setAttribute("aria-autocomplete","list"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"))};AccessibleAutoCompleteInputElement.prototype=new AutoCompleteInputElement;
AccessibleAutoCompleteInputElement.prototype.initACBox=function(){AutoCompleteInputElement.prototype.initACBox.call(this);this.acBox.div.setAttribute("role","listbox")};AccessibleAutoCompleteInputElement.prototype.hideACBox=function(){AutoCompleteInputElement.prototype.hideACBox.call(this);this.element.setAttribute("aria-expanded","false")};
AccessibleAutoCompleteInputElement.prototype.showACBox=function(){AutoCompleteInputElement.prototype.showACBox.call(this);this.element.setAttribute("aria-expanded","true")};AccessibleAutoCompleteInputElement.prototype.handleNav=function(a){KEY_TAB==a.keyCode?this.clearSuggestions():AutoCompleteInputElement.prototype.handleNav.call(this,a)};
AccessibleAutoCompleteInputElement.prototype.selectPrev=function(){if(this.isACBoxVisible()){var a=this.hasValidSelection()?this.selected-1:this.curSuggestions.length-1;0>a?this.deselect():(this.select(a),this.scrollDiv())}};AccessibleAutoCompleteInputElement.prototype.selectNext=function(){this.hasValidSelection()?this.selected+1==this.curSuggestions.length?this.deselect():(this.select((this.selected+1)%this.curSuggestions.length),this.scrollDiv()):this.isACBoxVisible()&&this.select(0)};
AccessibleAutoCompleteInputElement.prototype.select=function(a){AutoCompleteInputElement.prototype.select.call(this,a);a=0<=this.selected?Sfdc.get("."+AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+" .autoCompleteRowLink",this.acBox.div):null;this.element.setAttribute("aria-activedesendant",a&&a.id?a.id:"")};
AccessibleAutoCompleteInputElement.prototype.innerGetSuggestions=function(a){a=AutoCompleteInputElement.prototype.getSuggestions.call(this,a);return[{title:this.displayHeader?LC.getLabel("Sidebar_Search","result_source"):null,suggestions:a}]};
AccessibleAutoCompleteInputElement.prototype.getSuggestions=function(a){var b=[];if(this.groupedSuggestions=this.innerGetSuggestions(a))for(a=0;a<this.groupedSuggestions.length;a++)for(var c=this.groupedSuggestions[a],d=0;d<c.suggestions.length;d++)b.push(c.suggestions[d]);return b};AccessibleAutoCompleteInputElement.prototype.constructACBox=function(a,b){var c=[];this.addSuggestions(c,a,b);this.addFooter(c,!a?0:a.length);return c=this.hook_decorateHtml(c)};
AccessibleAutoCompleteInputElement.prototype.addSuggestions=function(a,b,c){if(null!==this.groupedSuggestions)for(var d=b=0;d<this.groupedSuggestions.length;d++){var e=this.groupedSuggestions[d];this.innerAddSuggestions(a,e.suggestions,c,b,d,e.title);b+=e.suggestions.length}};
AccessibleAutoCompleteInputElement.prototype.innerAddSuggestions=function(a,b,c,d,e,g){Sfdc.assert(Sfdc.isNumber(e),"GroupIndex must be specified, and of type Integer.");this.addMarkupBeforeGroup(a,e);e=this.id+":group"+e;if(g){var f=e+":title";a.push("\x3cdiv role\x3d'group' aria-labelledby\x3d'"+f+"'\x3e");a.push("\x3ch5 class\x3d'autoCompleteSectionRow' id\x3d'"+f+"'\x3e"+g+"\x3c/h5\x3e");a.push("\x3cul role\x3d'presentation' class\x3d'autoCompleteGroup'\x3e")}else a.push("\x3cul role\x3d'group' class\x3d'autoCompleteGroup'\x3e");
for(var f=!0,h=0;h<b.length;h++){var l=b[h];if(l&&l.name){var k=h+d;a.push("\x3cli role\x3d'presentation' ");a.push('onmouseover\x3d"');a.push("AutoCompleteInputElement.mouseOver('"+this.id+"', "+k+')"');a.push('onmouseout\x3d"');a.push("AutoCompleteInputElement.mouseOut('"+this.id+"', "+k+')"');a.push('onclick\x3d"');a.push("AutoCompleteInputElement.click('"+this.id+"', "+k+')"');this.compareSuggestions(c,l)?(a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+"' "),this.select(k),
f=!1):a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS+"' ");this.getSuggestionWidth()&&a.push(" style\x3d'width:"+this.getSuggestionWidth()+"px' ");a.push("id\x3d'"+AutoCompleteInputElement.getRowIdStatic(this.id,k)+"'\x3e");a.push("\x3ca class\x3d'autoCompleteRowLink' role\x3d'option' tabindex\x3d'-1' id\x3d'"+e+":option"+h+"'\x3e");a.push(this.getSuggestionHtml(l));a.push("\x3c/a\x3e\x3c/li\x3e")}}f&&this.deselect();a.push("\x3c/ul\x3e");g&&a.push("\x3c/div\x3e")};
AccessibleAutoCompleteInputElement.prototype.addMarkupBeforeGroup=function(a,b){};
(function(){function k(c){for(var d,a,b=0,g=c.offsetParent;g;)d=parseInt(c.style.marginLeft,10),isNaN(d)&&(d=0),a=parseInt(c.style.marginRight,10),isNaN(a)&&(a=0),b+=g.offsetWidth-(c.offsetLeft+c.offsetWidth+d+a),c=g,g=c.offsetParent;return b}var d=["online","offline","away"],c={ONLINE:10,OFFLINE:20,AWAY:100,isUmpsReady:function(){return window.umps&&umps.isReady&&!0===umps.isHoverEnabled},getPresence:function(d,h,a){umps.executeAction({method:"umps.presence.getPresenceStatus",data:{entityList:[d]},
callbackFn:function(b){b&&(b.data&&b.data[d]?h.call(a,b.data[d].presence.status):"offline"===b.errorCode&&h.call(a,c.OFFLINE))}})},startChat:function(c,d){umps.executeAction({method:"umps.chat.startChat",data:{entityID:c,chatType:d},callbackFn:function(){}})}};Sfdc.provide("SfdcApp.Chatter.Hover",function(){function f(a){Sfdc.apply(this,a);this.fadingIn=this.fadingOut=null;this.loaded=!1;(this.hover=Sfdc.get(this.id))||this.buildHover();this.hoverContent=Sfdc.get(".wrapper",this.hover);this.hoverChild=
Sfdc.get(".chatterHover",this.hover);this.lastMouseMoveElement=this.chatType=null;this.onAfterShowNowFired=this.onBeforeShowNowFired=this.onAfterHideNowFired=!1;a.hoverItem&&this.initHoverItem(a.hoverItem)}var h=null;Sfdc.apply(f.prototype,{show:function(a){a&&a!==this.hoverItem&&this.initHoverItem(a);if(this.fadingOut)clearTimeout(this.fadingOut),this.fadingOut=null;else if(!this.fadingIn){SfdcApp.ChatterHoverUtil.addChatterCoreCssIfNeeded();var b=this;h?h!==this&&(clearTimeout(h.fadingOut),h.fadingOut=
null,h.hideNow(),this.fadingIn=setTimeout(function(){b.showNow()},0)):this.fadingIn=setTimeout(function(){b.showNow()},800)}},initHoverItem:function(a){this.hoverItem=a;this.defaultDir=this.hoverItem.dir;this.viewport=this.hoverItem.viewport||null;this.moveHoverInDom();this.adjustPosition()},fireEvent:function(a){var b=a+"Fired";this[b]||(chatter.getEventBus().fireEvent("chatter:hover",a,{entityId:this.entityId,domId:this.hoverItem.id,dir:this.defaultDir}),this[b]=!0)},showNow:function(){this.onAfterHideNowFired=
!1;this.loaded||this.loader.load(this.hoverItem,function(a){null===a&&(a=LC.getLabel("Exception","UnhandledException"));Sfdc.Dom.updateHTML(this.hoverContent,a);Util.evalScriptsUnderElement(this.hoverContent);this.loaded=!0;this.adjustPosition()},this);h=this;null!==this.chatType&&this.updateUmps();this.moveHoverInDom();this.addHoverListener(!0);Sfdc.Dom.show(this.hover);this.adjustPosition();this.fireEvent("onAfterShowNow");this.fadingIn=null},moveHoverInDom:function(){if(!Sfdc.userAgent.isIE){var a=
Sfdc.Data.get(this.hover,"SfdcApp.Chatter.Hover.lastUsedBy");if(!a||a!==this.hoverItem.id)Sfdc.Data.set(this.hover,"SfdcApp.Chatter.Hover.lastUsedBy",this.hoverItem.id),this.hoverItem.insertElementAfterItem(this.hover)}},hide:function(){if(this.fadingIn)clearTimeout(this.fadingIn),this.fadingIn=null;else if(!this.fadingOut){var a=this;this.fadingOut=setTimeout(function(){a.hideNow()},400)}},hideNow:function(){h===this&&(h=null);this.addHoverListener(!1);this.chatType&&this.addChatControl("un");this.hover.style.display=
"none";this.fireEvent("onAfterHideNow");this.onAfterShowNowFired=this.onBeforeShowNowFired=!1;this.fadingOut=null},buildHover:function(){this.hover=document.createElement("div");this.hover.id=this.id;this.hover.style.position="absolute";var a=['\x3cdiv class\x3d"chatterHover"\x3e\x3cdiv class\x3d"wrapper"\x3e\x3cdiv class\x3d"loadHover"\x3e',LC.getLabel("Global","loading"),'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"arrow"\x3e\x3c/div\x3e\x3c/div\x3e'].join("");this.hover.innerHTML=a;document.body.appendChild(this.hover);
Sfdc.Dom.hideByDisplay(this.hover)},invertDirAboveBelow:function(a,b){"chatterHover-above"===this.defaultDir?a=this.isHigh(b)?"chatterHover-below":"chatterHover-above":"chatterHover-below"===this.defaultDir&&(a=this.isLow(b)?"chatterHover-above":"chatterHover-below");return a},invertDirForRtl:function(a){LC.isRtlPage()&&("chatterHover-left"===a?a="chatterHover-right":"chatterHover-right"===a&&(a="chatterHover-left"));return a},adjustPosition:function(){Sfdc.Dom.removeClass(this.hoverChild,["chatterHover-above",
"chatterHover-below","chatterHover-right","chatterHover-left"]);var a=this.hover.style;a.left=a.right="";a.position="absolute";a.zIndex=105;"chatterHover-above"===this.defaultDir||"chatterHover-below"===this.defaultDir?this.setPosAboveBelow():("chatterHover-right"===this.defaultDir||"chatterHover-left"===this.defaultDir)&&this.setPosRightLeft()},setPosAboveBelow:function(){var a=this.hoverItem.getPositionXY();this.hoverContent.style.top=0;this.defaultDir=this.invertDirAboveBelow(this.defaultDir,a);
Sfdc.Dom.addClass(this.hoverChild,this.defaultDir);if(LC.isRtlPage()){var b=this.hover.style;b.left=b.top="100px";a.x-=Sfdc.get(".arrow",this.hoverChild).offsetLeft}Sfdc.Dom.setElementXY(this.hover,[a.x,a.y+("chatterHover-above"===this.defaultDir?-Sfdc.Dom.getHeight(this.hover):this.hoverItem.getHeight())])},setPosRightLeft:function(){var a,b=this.hoverItem.getPositionXY(),c=this.invertDirForRtl(this.defaultDir),d=this.hover.style;Sfdc.Dom.addClass(this.hoverChild,c);d.position="absolute";d.zIndex=
105;a=parseInt(d.top,10);isNaN(a)&&(a=this.hover.offsetTop);d.top=b.y-Sfdc.Dom.getElementXY(this.hover).y+a+"px";"chatterHover-left"===c?d.right=k(this.hoverItem.el)+this.hoverItem.el.offsetWidth-(this.hover.offsetParent?k(this.hover.offsetParent):0)+"px":d.left=b.x+this.hoverItem.el.offsetWidth-(this.hover.offsetParent?Sfdc.Dom.getPositionXY(this.hover.offsetParent)[0]:0)+"px";this.loaded&&(this.isLow(b)?this.hoverContent.style.top=-(-40+Sfdc.Dom.getHeight(this.hoverContent))+"px":this.hoverContent.style.top=
"-20px")},isHigh:function(a){var b=this.viewport&&Sfdc.get(this.viewport);return b?a.y-(Sfdc.Window.getScrollY()||0)<0.5*Sfdc.Dom.getActualHeight(b,!0):a.y-(Sfdc.Window.getScrollY()||0)<0.5*Sfdc.Window.getWindowHeight()},isLow:function(a){var b=this.viewport&&Sfdc.get(this.viewport);return b?a.y-(Sfdc.Window.getScrollY()||0)>0.5*Sfdc.Dom.getActualHeight(b,!0):a.y-(Sfdc.Window.getScrollY()||0)>0.5*Sfdc.Window.getWindowHeight()},updateUmps:function(a){a&&(this.chatType=a);Sfdc.get(".chat",this.hover)?
c.isUmpsReady()?c.getPresence(this.entityId,function(a){var g=Sfdc.select("img.chatStatus",this.hover)[0],f=Sfdc.get(".chat",this.hover);switch(a){case c.AWAY:a="away";break;case c.ONLINE:a="online";break;case c.OFFLINE:a="offline";break;default:this.hideChat();return}Sfdc.Dom.removeClass(f,d);Sfdc.Dom.addClass(f,a);g&&(Sfdc.Dom.removeClass(g,d),Sfdc.Dom.addClass(g,a));"offline"!==a&&this.addChatControl("on")},this):this.hideChat():Sfdc.Function.delay(this.updateUmps,300,this,a)},hideChat:function(){var a=
Sfdc.select("img.chatStatus",this.hover)[0];a&&Sfdc.Dom.hideByVisibility(a);Sfdc.Dom.hideByVisibility(Sfdc.get(".chat",this.hover))},onChatClick:function(){c.startChat(this.entityId,this.chatType)},onChatKeyDown:function(){Sfdc.Event.isKeyAction(evt,Sfdc.Event.keyCode.ENTER)&&c.startChat(this.entityId,this.chatType)},addHoverListener:function(a){var b=Sfdc.userAgent.isIE;a?(Sfdc.on(this.hoverContent,b?"focusin":"focus",this.onFocus,this,!b),Sfdc.on(this.hoverContent,b?"focusout":"blur",this.hide,
this,!b),Sfdc.on(document,"mousemove",this.onMouseMove,this)):(Sfdc.un(this.hoverContent,b?"focusin":"focus",this.onFocus,!b),Sfdc.un(this.hoverContent,b?"focusout":"blur",this.hide,!b),Sfdc.un(document,"mousemove",this.onMouseMove))},onFocus:function(a){this.show(this.hoverItem)},onMouseMove:function(a){a=Sfdc.Event.getEventTarget(a);if(this.lastMouseMoveElement!==a){for(this.lastMouseMoveElement=a;a&&"BODY"!==a.tagName;){if(a===this.hoverContent||a===this.hoverItem.el){this.show(this.hoverItem);
return}a=a.parentNode}this.hide()}},addChatControl:function(a){var b=Sfdc.get(".chat",this.hover);Sfdc[a](b,"click",this.onChatClick,this);Sfdc[a](b,"keydown",this.onChatKeyDown,this)}});Sfdc.apply(f,{getOpenHover:function(){return h},direction:{RIGHT:"chatterHover-right",LEFT:"chatterHover-left",ABOVE:"chatterHover-above",BELOW:"chatterHover-below"}});return f}())})();
(function(){function k(d){d&&(Sfdc.apply(this,d),this.addListeners())}Sfdc.apply(k.prototype,{setListeners:function(d){var c=Sfdc.userAgent.isIE,f=this.getFocusElement();null===f&&Sfdc.log("ChatterHover: element not a link or wrapped in link or containing link. DomId:"+this.el.id);if(this.onShow&&(Sfdc[d](this.el,"mouseover",this.onMouseOver,this),f))Sfdc[d](f,c?"focusin":"focus",this.onMouseOver,this,!c);if(this.onHide&&(Sfdc[d](this.el,"mouseout",this.onHide,this),f))Sfdc[d](f,c?"focusout":"blur",
this.onHide,this,!c)},getFocusElement:function(){return Sfdc.Dom.isMatch(this.el,"a")||0<Sfdc.select("a",this.el).length?this.el:Sfdc.Dom.getParent(this.el,"a")},addListeners:function(){this.setListeners("on")},removeListeners:function(){this.setListeners("un")},onMouseOver:function(){this.purgeTitles();this.onShow()},getHeight:function(){var d=Sfdc.Dom.getHeight(this.el);if(0===d){var c=Sfdc.Dom.getFirstChild(this.el);c&&(d=Sfdc.Dom.getHeight(c))}return d},getWidth:function(){return Sfdc.Dom.getWidth(this.el)},
getPositionXY:function(){return Sfdc.Dom.getElementXY(this.el)},insertElementAfterItem:function(d){var c=Sfdc.Dom.getParent(this.el,"a");c||(c=this.el);c.parentNode.insertBefore(d,c.nextSibling)},purgeTitles:function(){this.shouldPurgeTitles&&(this.el.parentNode.removeAttribute("title"),k.purgeTitles(this.el),this.shouldPurgeTitles=!1)}});k.purgeTitles=function(d){var c,f;if(1===d.nodeType&&!Sfdc.Data.get(d,"SfdcApp.Chatter.Hover.titlePurged")){f=d.childNodes.length;for(c=0;c<f;c++)this.purgeTitles(d.childNodes[c]);
d.removeAttribute("title");Sfdc.Data.set(d,"SfdcApp.Chatter.Hover.titlePurged")}};Sfdc.provide("SfdcApp.Chatter.BaseHoverItem",k)})();
chatter.getHovers||function(){function k(a){t.call(this,a)}function d(a){var e=a.dom,b=SfdcApp.MruHovers.getSectionData(e);e.id||(e.id=Sfdc.getUID(e));this.dom=e;this.id=e.id;this.idsInSection=[];this.hoverItems=[];this.registeredHoverItemIds={};this.shouldPurgeTitles=a.shouldPurgeTitles;this.dir=b.dir;this.url=b.url;this.viewport=b.viewport;this.registerHoverItems()}function c(a){var e=u[a];e||(e=new SfdcApp.Chatter.Hover({entityId:a,id:a+"Hover",loader:l}),u[a]=e);return e}function f(){var a=SfdcApp.Chatter.Hover.getOpenHover();
a&&a.hideNow()}function h(){var a=SfdcApp.Chatter.Hover.getOpenHover();a&&a.adjustPosition()}function a(a,e,b){a=Sfdc.Data.get(e,p);v=!0;a?m[a].registerHoverItems():(a=m.push(new d({dom:e,shouldPurgeTitles:b}))-1,Sfdc.Data.set(e,p,a))}function b(a,e){if(null===e)a.push("null");else{var d=e.ownerDocument;if(d)try{var c=d.createElement("div");c.appendChild(e.cloneNode());a.push(c.innerHTML)}catch(f){a.push("NODE")}else if("object"===typeof e){a.push("{");for(var q in e)e.hasOwnProperty(q)&&(a.push(q),
a.push(":"),b(a,e[q]),a.push(","));a.pop();a.push("}")}else a.push(e)}}function g(a,e,d){chatter.getEventBus().addEventListener(a,e,function(e,c){try{d(e,c)}catch(f){var g;try{var h=[];b(h,c);g=h.join("")}catch(k){g="could not parse it: "+k.msg||k.message||""}g="INFO: [namespace: "+a+", eventname: "+e+", payload: "+g+"]";f.msg?f.msg+=g:f.message+=g;Sfdc.sendGack("CHATTERHOVER",f);Sfdc.Debug.error("chatterHover: Couldn't execute eventListener'",{error:f,namespace:a,eventname:e,payload:c})}})}function n(){for(;m.length;)m.shift().unregister()}
function r(a,e,b,c){a="{namespace: '"+a+"', eventname: '"+e+"'}";Sfdc.assert(Sfdc.isDefAndNotNull(b),"_extractHTMLElementFromPayload(): Expected the event "+a+" to have a payload.");b=b[c];Sfdc.assert(Sfdc.isDefAndNotNull(b),"_extractHTMLElementFromPayload(): Expected the payload of the event "+a+" to have the property '"+c+"'.");b=b.dom||b;Sfdc.assert(!!b.tagName,"_extractHTMLElementFromPayload(): Expected the property '"+c+"' of the payload of the event "+a+" to be either an ExtElement or a HTMLElement.");
return b}var u={},w=SfdcApp.MruHovers.SECTION_ATTRIBUTE,x=SfdcApp.MruHovers.SECTION_SELECTOR,y=SfdcApp.MruHovers.ITEM_ATTRIBUTE,z=SfdcApp.MruHovers.ITEM_SELECTOR,s=null,p="SfdcApp.ChatterHover.hsi",m=[],v=!1,t=SfdcApp.Chatter.BaseHoverItem.prototype.constructor;k.prototype=new t;Sfdc.apply(k.prototype,{onShow:function(){Sfdc.Dom.addClass(this.el,"chatter-hover-highlight");if(!s||s.id!==this.section.id)s=this.section;c(this.entityId).show(this)},onHide:function(){Sfdc.Dom.removeClass(this.el,"chatter-hover-highlight");
c(this.entityId).hide(this)}});Sfdc.apply(d.prototype,{getIdsInSection:function(){return this.idsInSection.slice(0)},registerHoverItems:function(){Sfdc.each(Sfdc.select(z,this.dom),function(a){var e=a.id;this.registeredHoverItemIds[e]||(e||(e=a.id="hoverItem"+Sfdc.getUID(a)),a=a.getAttribute(y),-1===this.idsInSection.indexOf(a)&&this.idsInSection.push(a),this.hoverItems.push(new k({el:Sfdc.get(e),section:this,dir:this.dir,id:e,entityId:a,shouldPurgeTitles:this.shouldPurgeTitles,viewport:this.viewport})),
this.registeredHoverItemIds[e]=!0)},this)},unregister:function(){for(;this.hoverItems.length;)this.hoverItems.shift().removeListeners();Sfdc.Data.clear(this.dom,p);SfdcApp.MruHovers.setRegistered(this.dom,null)}});var l={_URL:"/ui/common/MRUHoverLoader",_MAX_IDS_PER_REQUEST:50,_response:"",_loadedEntityIds:{},_buildUrl:function(a,e){var b,c=UserContext.getUrl(l._URL)+"?hoverIds\x3d"+a.join("\x26hoverIds\x3d");e&&(c+="\x26"+e);c+="\x26isChatterPage\x3d"+("undefined"!==typeof chatter);(b=window.Shepherd)&&
c&&(c=b.fixRetUrl(c));return c},_extractResponse:function(a){var e,b,c=l._response;e="\x3c"+a+"\x3e";var d="\x3c/"+a+"\x3e",f=c.indexOf(e),d=c.indexOf(d);-1!==f&&-1!==d?e=c.slice(f+e.length,d):(b=(new Date).getTime(),e=LC.getLabel("Exception","UnhandledException")+"\n"+LC.getLabel("Exception","UnhandledException_errorid")+b,Sfdc.logServer("CHATTERHOVER",Sfdc.Logging.formatError({message:"errorId: "+b+" ChatterHover could not be loaded for entity: "+a+" [start, end]\x3d["+f+", "+d+"] LOADER._response\x3d"+
c.replace(/%/g,"PR")}),Sfdc.Logging.LogLevel.INFO));return e},load:function(a,b,c){var d,f,g,h=[],k=l._loadedEntityIds,m=a.section;g=m.getIdsInSection();for(f=0;f<g.length;f++)d=g[f],d!==a.entityId&&!k[d]&&h.push(d);h=h.splice(0,l._MAX_IDS_PER_REQUEST);k[a.entityId]||(h.pop(),h.push(a.entityId));0===h.length?b.call(c,l._extractResponse(a.entityId)):Sfdc.Ajax.request(l._buildUrl(h,m.url),{success:function(d){l._response=l._response.concat(d);for(d=0;d<h.length;d++)l._loadedEntityIds[h[d]]=!0;b.call(c,
l._extractResponse(a.entityId))},failure:function(){b.call(c,null)}})}};chatter.extend("Hovers",function(){return{closeHoverIfShown:f,addUmps:function(a,b){c(a).updateUmps(b)},notify:function(b){var c=null;Sfdc.assert(Sfdc.isDefAndNotNull(b),"chatter.getHovers().notify: element is null or undefined");b.dom&&(b=b.dom);c=b.getAttribute(w)?b:Sfdc.Dom.getParent(b,x);Sfdc.assert(null!==c&&"undefined"!==typeof c,"A hover enabled element has to be placed inside an element with attribute "+w);a(null,c)},
adjustOpenHover:h,dbgRegisterSectionCalled:v}});SfdcApp.MruHovers.registerSection=a;Sfdc.on(window,"load",function(){var b=SfdcApp.MruHovers.registerHovers;g("chatter:feed","onAfterShowMoreFeedItems",function(b,c){Sfdc.assert(Sfdc.isDefAndNotNull(c),"Got null payload from {namespace: chatter:feed, eventname: onAfterShowMoreFeedItems}");for(var d=c.firstFeedItem;d;)a(null,d.dom,!0),d=d.next(".cxfeeditem")});g("unifiedSearchPage:feedSearchResults","onAfterResultsShown",b);g("chatter:feed","onAfterFeedRefresh",
function(){n();b()});g("chatter:feed","onAfterToggleShow",function(){n();b()});g("chatter:feed","onAfterLoadFromCache",function(){n();b()});g("chatter:feed","onAfterNewPostFeedUpdate",function(b,c){a(null,r("chatter:publisher",b,c,"feedItem"))});g("chatter:hover","onAfterUpdate",function(a,b){chatter.getHovers().notify(r("chatter:hover",a,b,"container"))});g("chatter:publisher","onAfterComment",function(a,b){chatter.getHovers().notify(r("chatter:publisher",a,b,"element"))});g("chatter:files","onAfterDialogOpen",
f)})}();
DeflectionAutoComplete=function(b,a,c,d){this.MIN_SEARCH_QUERY_LENGTH=4;DeflectionAutoComplete.superclass.constructor.call(this,b,a,0,c,!0);this.chatter=d;this.displayHeader=!0};Ext.extend(DeflectionAutoComplete,AutoCompleteInputElement);DeflectionAutoComplete.ROW_HEIGHT=1.7;DeflectionAutoComplete.FOOTER_HEIGHT=0;DeflectionAutoComplete.prototype.delay=500;DeflectionAutoComplete.prototype.isModalLoaded=!1;
DeflectionAutoComplete.prototype.complete=function(){Sfdc.resolve("Sfdc.servicedeskview")?srcUp(this.getSelectedItemUrl(this.curSuggestions[this.selected].type,!0)):this.showModal()};DeflectionAutoComplete.prototype.getInput=function(){return Sfdc.String.trim(this.element.value).length<this.MIN_SEARCH_QUERY_LENGTH?"":this.element.value};DeflectionAutoComplete.prototype.getCacheKey=function(b){return Sfdc.String.trim(b)};DeflectionAutoComplete.prototype.isValidSuggestion=function(b,a){return!0};
DeflectionAutoComplete.prototype.getSuggestionHtml=function(b){if("KBArticle"===b.type)return this.getArticleHtml(b);if("Question"==b.type)return this.getQuestionHtml(b)};
DeflectionAutoComplete.prototype.getArticleHtml=function(b){var a=[];a.push("\x3cdiv class\x3d'deflectionResultsArticleRow'\x3e");a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsArticleIcon'/\x3e");a.push("\x3cspan class\x3d'deflectionResultsArticleTitle'\x3e\x3ca href\x3d'javascript:void(0);'\x3e");a.push(escapeHTML(b.name));a.push("\x3c/a\x3e\x3c/span\x3e");a.push("\x3c/div\x3e");return a.join("")};
DeflectionAutoComplete.prototype.getQuestionHtml=function(b){var a=[];a.push("\x3cdiv class\x3d'deflectionResultsQuestionRow'\x3e");a.push("\x3cspan class\x3d'deflectionResultsTitleContainer'\x3e");a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsQuestionIcon'/\x3e");a.push("\x3cspan class\x3d'deflectionResultsQuestionTitle'\x3e\x3ca href\x3d'javascript:void(0);'\x3e");a.push(escapeHTML(b.name));a.push("\x3c/a\x3e\x3c/span\x3e");a.push("\x3c/span\x3e");a.push("\x3cspan class\x3d'commentBestAnswerContainer'\x3e");
if(b.dHasBestAnswer){var c=escapeHTML(LC.getLabel("QuestionFeedItemPublisher","QuestionWithBestAnswer"));a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsAnsweredIcon' alt\x3d'");a.push(c);a.push("' title\x3d'");a.push(c);a.push("'/\x3e");a.push('\x3cspan class\x3d"deflectionResultsQuestionAnswered"');a.push("' title\x3d'");a.push(c);a.push("'/\x3e");a.push(escapeHTML(LC.getLabel("QuestionFeedItemPublisher","Answered")));a.push("\x3c/span\x3e")}c=1==b.dCommentCount?
LC.getLabel("Feeds_QuestionPost","CommentsSummarySingular"):LC.getLabel("Feeds_QuestionPost","CommentsSummaryPlural",b.dCommentCount);a.push('\x3cspan class\x3d"deflectionResultsCommentCount noofcommentsicon" title\x3d"');a.push(c);a.push('"/\x3e');a.push(b.dCommentCount);a.push("\x3c/span\x3e");a.push("\x3c/span\x3e");a.push("\x3c/div\x3e");return a.join("")};
DeflectionAutoComplete.prototype.showSpinner=function(){this.spinner||(this.spinner=Sfdc.get(".publisherSpinnerPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")));this.spinner&&Sfdc.Dom.show(this.spinner)};DeflectionAutoComplete.prototype.hideSpinner=function(){this.spinner||(this.spinner=Sfdc.get(".publisherSpinnerPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")));this.spinner&&Sfdc.Dom.hideByDisplay(this.spinner)};
DeflectionAutoComplete.prototype.retrieveFromServlet=function(b){this.serverCallTimeOut&&clearTimeout(this.serverCallTimeOut);var a=this;a.hideNoResultsMessage();a.showSpinner();this.serverCallTimeOut=setTimeout(function(){DeflectionAutoComplete.superclass.retrieveFromServlet.call(a,b)},this.delay)};DeflectionAutoComplete.DIALOG_ID="ChatterDeflectionModal";
DeflectionAutoComplete.prototype.showModal=function(){if(!this.element||!this.hasValidSelection())return!1;var b=this,a,c=this.curSuggestions[this.selected].type,d="KBArticle"===c?escapeHTML(this.curSuggestions[this.selected].dTitle):LC.getLabel("QuestionFeedItemPublisher","SuggestedQuestions"),e="0px",g=this.getSelectedItemUrl(c,!1),f="";if("KBArticle"==c)f='\x3cdiv class\x3d"articleFullLinkDiv"\x3e\x3ca class\x3d"articleFullLink"  href\x3d"'+Sfdc.Url.generateUrl(this.curSuggestions[this.selected].urlLink,
{popup:"true",inModalDisplay:"false"})+'" target\x3d"_blank"\x3e'+LC.getLabel("KBArticleDeflection","KBArticleFullLink")+"\x3c/a\x3e\x3c/div\x3e";else if("Question"==c)e="10px";else return!1;DeflectionAutoComplete.dialog||(a=new OverlayDialog,a.id=DeflectionAutoComplete.DIALOG_ID,a.setWidth(730),a.setMinHeight(400),a.register(),a.setTitle(d),a.cancel=function(a){DeflectionAutoComplete.prototype.isModalLoaded=!1;Sfdc.Dom.removeClass(document.body,"DeflectionAutoCompleteOverlayBackground");this.hide();
a&&(b.clearACBox(),b.focused=!0,b.clearCache(),b.displaySuggestions());b.element.focus()},a.addEvents(),DeflectionAutoComplete.dialog=a);a=[];a.push('\x3ciframe id\x3d"ModalIframe" frameborder\x3d"no" src\x3d"'+g+'" style\x3d"border:0;height:400px;width:100%;" '+("KBArticle"===c?"onload\x3dDeflectionAutoComplete.redirect(this.contentWindow.location)":"")+"\x3e\x3c/iframe\x3e"+f);Sfdc.Dom.setStyles(Sfdc.get(DeflectionAutoComplete.dialog.id+"Content"),{paddingRight:"0px",paddingLeft:e,paddingBottom:"0px",
border:"0px",overflow:"hidden"});if(dialogContent=Ext.get(DeflectionAutoComplete.dialog.id+"Content"))dialogContent.update(a.join("")),DeflectionAutoComplete.dialog.setTitle(d),DeflectionAutoComplete.dialog.show(),Sfdc.Dom.addClass(document.body,"DeflectionAutoCompleteOverlayBackground");return!0};
DeflectionAutoComplete.prototype.getSelectedItemUrl=function(b,a){var c;"KBArticle"==b?c=Sfdc.Url.generateUrl(this.curSuggestions[this.selected].urlLink,{popup:"true",inModalDisplay:!a}):"Question"==b&&(c=Sfdc.Url.generateUrl(chatter.getToolbox().sitePrefix()+"/_ui/ui/deflection/QuestionModalPage",{subjectId:chatter.getFeed().getConfig().subjectId,fId:this.curSuggestions[this.selected].dId,inModalDisplay:"true",feedType:chatter.getFeed().getConfig().feedType}));a&&(c=Sfdc.Url.generateUrl(c,{isdtp:"vw"}));
return c};DeflectionAutoComplete.redirect=function(b){DeflectionAutoComplete.prototype.isModalLoaded&&window.parent.open(b,"_top");DeflectionAutoComplete.prototype.isModalLoaded=!0};Sfdc.onReady(function(){chatter.getEventBus().addEventListener("chatter:feed","onAfterDeleteFeedItem",function(b,a){var c;window.parent.sfdcPage&&(c=window.parent.sfdcPage.getDialogById(DeflectionAutoComplete.DIALOG_ID));c&&c.cancel(!0)})});DeflectionAutoComplete.prototype.getRequestParams=function(){return{subjectId:this.chatter.getFeed().getConfig().subjectId}};
DeflectionAutoComplete.prototype.getACBoxHeight=function(b){return b*DeflectionAutoComplete.ROW_HEIGHT+DeflectionAutoComplete.FOOTER_HEIGHT+AutoCompleteInputElement.ROW_HEIGHT_UNITS};DeflectionAutoComplete.prototype.hook_registerEventHandlers=function(){var b=this,a=function(){b.focused=!0;b.displaySuggestions()};addEvent(this.element,"blur",a);addEvent(this.element,"keydown",function(b){13==b.keyCode&&a()})};
DeflectionAutoComplete.prototype.addACBoxToPage=function(b){Sfdc.get(".publisherDeflectionPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")).appendChild(b)};DeflectionAutoComplete.prototype.positionACBox=function(b){if(this.element&&this.acBox&&(!b||this.isACBoxVisible()))this.acBox.setStyle("position","relative"),this.acBox.setStyle("width","auto")};DeflectionAutoComplete.prototype.updateWidth=function(){};DeflectionAutoComplete.prototype.getMaxSuggestionsToDisplay=function(){return 7};
DeflectionAutoComplete.prototype.addHeader=function(b){this.displayHeader&&b.push('\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"deflectionResultsHeader"\x3e'+LC.getLabel("QuestionFeedItemPublisher","DeflectionResultsHeader")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e ")};DeflectionAutoComplete.prototype.showACBox=function(){this.acBox.setStyle("display","block");Sfdc.Effects.rollIn(this.acBox.div,this.hook_Show,{duration:400})};
DeflectionAutoComplete.prototype.getNoResultsMessage=function(){this.noResultsMessage||(this.noResultsMessage=Sfdc.get(".publisherDeflectionNoResultsPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")));return this.noResultsMessage};DeflectionAutoComplete.prototype.showNoResultsMessage=function(){this.getNoResultsMessage()&&Sfdc.Dom.show(this.getNoResultsMessage())};DeflectionAutoComplete.prototype.hideNoResultsMessage=function(){this.getNoResultsMessage()&&Sfdc.Dom.hideByDisplay(this.getNoResultsMessage())};
DeflectionAutoComplete.prototype.hook_beforeShowSuggestions=function(){this.hideSpinner();this.hideNoResultsMessage()};DeflectionAutoComplete.prototype.hook_onEmptyServletResult=function(b){this.hideSpinner();this.additionalDisplayConditionsValid(b)&&this.showNoResultsMessage()};DeflectionAutoComplete.prototype.additionalDisplayConditionsValid=function(b){if((b=chatter.getPublisher().getHandler("QuestionPost"))&&Sfdc.isFunction(b.isTitleEmptyOrPrompt)){var a=this.getInput();return!b.isTitleEmptyOrPrompt(a)}return DeflectionAutoComplete.superclass.additionalDisplayConditionsValid()};
Sfdc.provide("SfdcApp.InfluenceInfoHover",{hover:null,getHover:function(a,b){this.hover||(a.id=Sfdc.getUID(a),SfdcApp.Chatter.BaseHoverItem.purgeTitles(a),this.hover=new SfdcApp.Chatter.Hover({entityId:b,id:"InflHov-"+a.id,hoverItem:new SfdcApp.Chatter.BaseHoverItem({entityId:b,el:a,dir:SfdcApp.Chatter.Hover.direction.RIGHT,id:a.id}),loader:{load:function(a,c,d){chatter.getToolbox().post({url:"/influence/info/"+b,success:function(a,b){c.call(d,b.html)},failure:function(){c.call(d,null)}})}}}));return this.hover},
show:function(a,b){this.getHover(a,b).show()},hide:function(a,b){this.getHover(a,b).hide()}});
PublisherAutoComplete=function(a,b,c,d,e,g,f,h){this.MIN_HASHTAG_QUERY_LENGTH=this.MIN_MENTION_QUERY_LENGTH=2;this.MIN_HASHTOPIC_QUERY_LENGTH=3;PublisherAutoComplete.superclass.constructor.call(this,a,b,-1,c,!0);this.groupAtMentionsEnabled=e;this.hashTopicEnabled=Sfdc.Dom.hasClass(this.element,"chatterTopicsEnabled");this.hashtagACDisabled=Sfdc.Dom.hasClass(this.element,"hashtagACDisabled");this.feedItemId=d;this.ajaxState="none";this.atMentions=[];this.atMentionPattern={start:"@[",end:"]"};this.hashMentionPattern=
{start:"#[",end:"]"};this.deniedUsers=[];this.textUtil=chatter.getTextUtil();this.activeAtMention={hasMention:!1};this.feedItemParentId=g;this.feedItemParentName=f;this.currentRequestId=0;this.feedItemVisibility=h;this.fetchingPage=!1;a=chatter.getEventBus();a.addEventListener("chatter:publisher","onAfterUpdateStatus",this.clearMruCache);a.addEventListener("chatter:publisher","onAfterComment",this.clearMruCache);this.indexStartAC=-1;this.isOverlay=!1;Sfdc.on(this.element,"mouseup",function(){this.activeAtMention=
this.isMention("inside")},this);this.feedSubjectId=function(){var a=chatter.getFeed().config;return d&&a&&a.subjectId?a.subjectId:g}()};Ext.extend(PublisherAutoComplete,AutoCompleteInputElement);PublisherAutoComplete.prototype.clearMruCache=function(a){PublisherAutoComplete.acCache.cache&&(PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]=null);PublisherAutoComplete.acCache.retryNextQuery=!0};PublisherAutoComplete.prototype.getValue=function(){return this.textUtil.getValue(this.element)};
PublisherAutoComplete.prototype.clearAtMentions=function(){this.atMentions=[];this.deniedUsers=[]};PublisherAutoComplete.prototype.getInputWithEncodedAtMentions=function(){return this.replaceMentions(this.getValue())};
PublisherAutoComplete.prototype.replaceMentions=function(a){for(var b=this.atMentions,c=this.atMentionPattern,d=b.length-1;0<=d;d--){var e=b[d],g=c.start+e.UserName+c.end,f=a.lastIndexOf(g),h=g.length;0<=f&&(g=a.substring(0,f),a=a.substring(f+h),a=g+"{"+PublisherAutoComplete.MENTION_KEY+e.UserId+"}"+a)}return a.replace(/\u200f/g,"").replace(/\u200e/g,"")};PublisherAutoComplete.prototype.setIsOverlay=function(a){this.isOverlay=a};PublisherAutoComplete.prototype.onfocus=function(){this.focused=!0};
PublisherAutoComplete.IS_RTL="rtl"==Ext.select("html").item(0).getAttribute("dir");PublisherAutoComplete.MAX_SUGGESTIONS=11;PublisherAutoComplete.BOX_CSS_CLASS=AutoCompleteInputElement.BOX_CSS_CLASS+" publisherAC_box";PublisherAutoComplete.ROW_CSS_CLASS=AutoCompleteInputElement.ROW_CSS_CLASS+" publisherAC_row";PublisherAutoComplete.ROW_CSS_CLASS_SELECTED=AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+" publisherAC_row";
PublisherAutoComplete.ROW_CSS_CLASS_MOUSE_OVER=PublisherAutoComplete.ROW_CSS_CLASS+" publisherAC_row_hover";PublisherAutoComplete.TITLE_ROW_CSS_CLASS=AutoCompleteInputElement.TITLE_ROW_CSS_CLASS+" publisherAC_title";PublisherAutoComplete.TITLE_ROW_CSS_CLASS_SELECTED="publisherAC_title_selected";PublisherAutoComplete.TITLE_ROW_CSS_CLASS_CLICKABLE="publisherAC_clickableTitle publisherAC_hr";PublisherAutoComplete.HELP_TEXT_CSS_CLASS=AutoCompleteInputElement.TITLE_ROW_CSS_CLASS+" publisherAC_help";
PublisherAutoComplete.LIST_CSS_CLASS="publisherAC_list";PublisherAutoComplete.AUTOFETCH_LOADING_CSS_CLASS="autofetchloading";PublisherAutoComplete.prototype.setACBoxHeight=function(a){var b=this.getMaxSuggestionsToDisplay(),c=!this.isACMention;a>b?(a=b*(AutoCompleteInputElement.ROW_HEIGHT+0.1),c&&(a=a+2.1+2.3),a+=AutoCompleteInputElement.ROW_HEIGHT_UNITS,this.acBox.setStyle("height",a),this.scrolling=!0):(this.acBox.setStyle("height","auto"),this.scrolling=!1)};
PublisherAutoComplete.prototype.updateACBox=function(a,b){this.element&&(!a||0===a.length?this.acBox&&this.clearACBox():(this.acBox||this.initACBox(),this.displayACBox(a,b),this.loadingScreen=new LoadingScreen(Sfdc.get("."+PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS,this.acBox.div),LC.getLabel("Global","loading")),0===this.currentPageFetch&&(this.curSuggestions&&this.curSuggestions.length<PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE)&&(this.allResultsReturned=!0),this.curSuggestions&&(0<this.curSuggestions.length&&
0===this.currentPageFetch)&&this.select(0),this.scrollDiv(),this.updateWidth()))};PublisherAutoComplete.prototype.showACBox=function(){"block"!=this.acBox.getStyle("display")&&(this.acBox.setStyle("display","block"),this.announcementDone=!1)};
PublisherAutoComplete.prototype.constructACBox=function(a,b){var c=["\x3col class\x3d'"+PublisherAutoComplete.LIST_CSS_CLASS+"'\x3e"];this.addSuggestions(c,a,b,0);0===a.length&&this.addEmptyRow(c,LC.getLabel("PublisherAutoComplete","noResults"));c.push("\x3c/ol\x3e");c.push("\x3cdiv class\x3d'"+PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS+"'\x3e\x3c/div\x3e");return c};PublisherAutoComplete.prototype.addEmptyRow=function(a,b){a.push('\x3cli\x3e\x3cdiv class\x3d"publisherAC_noMatch"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e")};
PublisherAutoComplete.prototype.addSuggestions=function(a,b,c,d){if(b)for(var e=!this.isACMention&&this.hashTopicEnabled?" topicName":"",g=0,f=b.length;g<f;g++){var h=b[g];if(h&&(h.UserName||h.value)){var k=g+d;a.push("\x3cli\x3e");a.push("\x3cdiv ");a.push('onmouseover\x3d"');a.push("PublisherAutoComplete.mouseOver('"+this.id+"', "+k+')"');a.push('onmouseout\x3d"');a.push("PublisherAutoComplete.mouseOut('"+this.id+"', "+k+')"');a.push('onmousedown\x3d"');a.push("PublisherAutoComplete.click(event,'"+
this.id+"', "+k+');"');this.compareSuggestions(c,h)?(a.push("class\x3d'"+PublisherAutoComplete.ROW_CSS_CLASS_SELECTED+"' "),this.select(k)):a.push("class\x3d'"+PublisherAutoComplete.ROW_CSS_CLASS+"' ");a.push("id\x3d'"+AutoCompleteInputElement.getRowIdStatic(this.id,k)+"'\x3e\x3cspan class\x3d'acName"+e+"'\x3e");a.push(this.getSuggestionHtml(h));!this.isACMention&&h.desc&&a.push("\x3c/span\x3e\x3cspan class\x3d'acInfo topicInfo'\x3e"+h.desc);a.push("\x3c/span\x3e\x3c/div\x3e");a.push("\x3c/li\x3e")}}};
PublisherAutoComplete.prototype.addHeader=function(a,b,c){c?a.push('\x3cli\x3e\x3cdiv class\x3d"'+PublisherAutoComplete.TITLE_ROW_CSS_CLASS+' publisherAC_hr"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e"):a.push('\x3cli\x3e\x3cdiv class\x3d"'+PublisherAutoComplete.TITLE_ROW_CSS_CLASS+'"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e")};PublisherAutoComplete.prototype.removeClassBridge=function(a,b){var c=b.split(" ");if(1<c.length)for(var d=0;d<c.length;d++)a.removeClass(c[d]);else a.removeClass(c)};
PublisherAutoComplete.prototype.select=function(a){var b=null;0<=this.selected&&(b=this.getRowEl(this.selected))&&this.removeClassBridge(b,AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED);this.selected=a;(b=this.getRowEl(a))&&b.addClass(AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED)};PublisherAutoComplete.prototype.selectNext=function(){this.cycleSelection(!0)};PublisherAutoComplete.prototype.selectPrev=function(){this.cycleSelection(!1)};
PublisherAutoComplete.prototype.cycleSelection=function(a){if(this.hasValidSelection()){var b=a?this.selected+1:this.selected-1;a?this.select(b>=this.curSuggestions.length?0:b):this.select(0>b?this.curSuggestions.length-1:b);this.scrollDiv()}};
PublisherAutoComplete.prototype.initACBox=function(){if(this.element){this.acBox=document.createElement("div");var a=this;addEvent(this.acBox,"mouseover",function(){a.acBoxFocused=!0});addEvent(this.acBox,"mouseout",function(){a.acBoxFocused=!1;a.onClickFired||(a.element.focus(),a.focused=!0)});addEvent(this.acBox,"scroll",function(){var b=a.acBox.div,d=Sfdc.Dom.getActualHeight(b,!0),e=Sfdc.Dom.getHeight(b),b=Sfdc.get(b).scrollTop;if((shouldAutoFetchMore=e+b>PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT*
d)&&!a.fetchingPage&&!a.allResultsReturned)a.currentPageFetch+=1,a.currentPageFetch>PublisherAutoComplete.MAX_AUTO_FETCHES||(a.fetchingPage=!0,a.loadingScreen.show(),a.appendResults=!0,a.appendPageFromCacheOrServlet(a.lastInput))});this.acBox.id=this.id+AutoCompleteInputElement.BOX_ID;this.acBox.className=PublisherAutoComplete.BOX_CSS_CLASS;this.addACBoxToPage(this.acBox);this.acBox=new IframeShim(this.acBox);this.acBox.setStyle("width",this.getMinimumWidth()+"px");if(this.isOverlay){var b=Ext.get(this.element).parent(".overlayDialog").getStyle("z-index");
this.acBox.setStyle("zIndex",b+10)}AutoCompleteInputElement.hasResizeHandler||(addEvent(window,"resize",AutoCompleteInputElement.resizeHandler),AutoCompleteInputElement.hasResizeHandler=!0)}};PublisherAutoComplete.prototype.getMinimumWidth=function(){return this.element.clientWidth+10};
PublisherAutoComplete.prototype.complete=function(){if(!this.element||!this.curSuggestions)return!1;var a=this.curSuggestions[this.selected];if(!a&&this.isACMention)return!1;a&&this.isACMention&&this.atMentions.push(a);a=this.innerComplete(a);this.setCaretLocation(a);this.indexStartAC=-1;this.clearACBox();this.resizeTextArea();return!0};
PublisherAutoComplete.prototype.innerComplete=function(a){var b=this.getWordToComplete();if(!this.isACMention&&!a&&this.element&&b&&1<b.length)a=this.insertNode({value:this.formatTopicName(b.substring(1))},this.getCaretLocation());else{if(!this.element||!a||0===a.length)return;a=this.insertNode(a,this.getCaretLocation())}this.clearSuggestions();return a};PublisherAutoComplete.prototype.getCaretLocation=function(a){return this.textUtil.getCaretLocation(this.element)};
PublisherAutoComplete.prototype.setCaretLocation=function(a){this.textUtil.setCaretLocation(this.element,a)};
PublisherAutoComplete.prototype.insertNode=function(a,b){var c=this.getValue(),d,e;this.isACMention?(this.checkCanReadFeed(a),d=c.lastIndexOf(this.getWordToComplete(),b-1),e=this.createMention(a)):(this.hashTopicEnabled?(d=b-this.lastInput.length,"["===c.charAt(d)&&d--,"]"===c.charAt(b)&&b++):d=c.lastIndexOf("#",b-1),e=this.createHashtag(a));if(-1===d)return b;this.element.value=c.substring(0,d)+e+c.substring(b);Sfdc.userAgent.isIE&&(d=c.substring(0,d).replace(/\r\n/g,"n").length);return d+e.length};
PublisherAutoComplete.prototype.retrieveFromServlet=function(a){if(!a)return!1;if("#"===a.charAt(0)||"@"===a.charAt(0))a=a.charAt(0)+Sfdc.String.trim(a.substring(1));a=Sfdc.String.trim(a);if(this.isACMention&&a.length<this.MIN_MENTION_QUERY_LENGTH||!this.isACMention&&this.hashTopicEnabled&&a.length<this.MIN_HASHTOPIC_QUERY_LENGTH||!this.isACMention&&!this.hashTopicEnabled&&a.length<this.MIN_HASHTAG_QUERY_LENGTH)return!1;this.requestParams[AbstractAutoCompleteServlet.pINPUT]=a.substring(1);this.requestParams[PublisherAutoComplete.PARAM_LOOKUP_TYPE]=
this.isACMention?PublisherAutoComplete.LOOKUP_TYPE_MENTION:PublisherAutoComplete.LOOKUP_TYPE_HASHTAG;this.requestParams[PublisherAutoComplete.PARAM_PAGE_NUM]=this.currentPageFetch;this.requestParams[PublisherAutoComplete.PARAM_PAGE_SIZE]=PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE;!this.isACMention&&!this.hashTopicEnabled&&(this.requestParams[PublisherAutoComplete.PARAM_HASHTAG_LIST_TYPE]=PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]?PublisherAutoComplete.HASHTAG_LIST_TYPE_POPULAR_HASHTAGS:
PublisherAutoComplete.HASHTAG_LIST_TYPE_BOTH);var b=this,c=this.getCacheKey(a),d=this.currentRequestId+1;this.currentRequestId=d;delay=PublisherAutoComplete.REQUEST_DELAY;this.isACMention&&a.length==this.MIN_MENTION_QUERY_LENGTH&&(delay=PublisherAutoComplete.REQUEST_DELAY_LONG);setTimeout(function(){d===b.currentRequestId&&(PublisherAutoComplete.acCache.triedQueries[c]=!0,b.requestParams.feedItemId=b.feedItemId,b.requestParams.feedSubjectId=b.feedSubjectId,b.ajaxState="initialized",chatter.getToolbox().get({url:b.servletURI,
params:b.requestParams,success:function(c,d){b.ajaxState="finished";b.isACMention?b.saveToCache(a,d[PublisherAutoComplete.MENTION_RESULTS]):b.hashTopicEnabled?b.saveToCache(a,d.suggestions):b.saveToCache(a,d[PublisherAutoComplete.POPULAR_TAGS],d[PublisherAutoComplete.MY_HASH_TAGS]);b.fetchingPage=!1;b.appendResults?b.appendSuggestions():b.displaySuggestions(!0)},failure:function(c,d){b.ajaxState="finished";b.isACMention||b.hashTopicEnabled&&b.saveToCache(a,[]);b.displaySuggestions(!0)}}))},delay);
return!0};PublisherAutoComplete.prototype.handleInput=function(a){Sfdc.Event.isKeyAction(a,[KEY_ARROW_U,KEY_ARROW_D])||(this.currentPageFetch=0,this.allResultsReturned=this.fetchingPage=this.appendResults=!1);AutoCompleteInputElement.prototype.handleInput.call(this,a)};
PublisherAutoComplete.prototype.displaySuggestions=function(a){if(this.element&&this.focused&&(!a||this.isACMention||this.isACBoxVisible())){var b;if(a)b=this.lastInput;else{if(!this.isACMention){b=this.getValue();var c=PublisherAutoComplete.getWordToCompleteStartIndex(b,this.textUtil.getCaretLocation(this.element));0<=this.indexStartAC&&(0<=c&&c!=this.indexStart)&&(this.indexStartAC=c,b.charAt(this.indexStartAC)===PublisherAutoComplete.MENTION_KEY&&(this.isACMention=!0))}b=this.getWordToComplete()}this.isACMention||
"["===b.charAt(1)&&(b="#"+b.substring(2));if(!this.hashtagACDisabled||this.isACMention){var c=this.id,d=this.isACMention&&this.hasReachedMaxMentions(),e=chatter.getTextareaMessageUtil().isMessageDisplayed(c,"limitMention");if(d!==e){if(d){chatter.getTextareaMessageUtil().showMessage({el:c,type:2,append:!0,msg_html:LC.getLabel("PublisherAutoComplete","limitMention",PublisherAutoComplete.MAX_MENTION),msg_id:"limitMention"});return}chatter.getTextareaMessageUtil().hideMessage({el:c,msg_id:"limitMention"})}this.displaySuggestionsFor(b,
a)}}};
PublisherAutoComplete.prototype.displaySuggestionsFor=function(a,b){if(b||a!=this.lastInput||!this.isACBoxVisible())if(this.lastInput=a,""===a)this.indexStartAC=-1,this.clearSuggestions();else if(!this.isACMention&&this.hashTopicEnabled&&(a.match("^#\\s")||a.length>1+PublisherAutoComplete.TOPIC_LENGTH||3<a.split(" ").length||0<a.search("\\s\\s+")||0<a.search("[\\.,\\]]")))this.clearSuggestions();else if(1==a.length)this.displayHelpACBox();else{var c=null;this.hasValidSelection()&&(c=this.curSuggestions[this.selected]);this.curSuggestions=
this.getSuggestions(a);this.curSuggestions.not_in_cache||(this.updateACBox(this.curSuggestions,c),this.announcementDone||(this.announcementDone=!0))}};PublisherAutoComplete.prototype.getAjaxState=function(){return this.ajaxState};PublisherAutoComplete.prototype.formatTopicName=function(a){a=Sfdc.String.trim(a).split(/\s+/);for(var b=0;b<a.length;b++)a[b]=a[b].charAt(0).toUpperCase()+a[b].substr(1);return a.join(" ")};
PublisherAutoComplete.prototype.getSuggestions=function(a){var b=this.checkCacheOrRetrieve(a);if(!b)return{not_in_cache:1};b=this.getValidSuggestions(a,b);if(!this.isACMention&&this.hashTopicEnabled){var c=this.getCaseInsensitivetMatch(a,b);0>c?b.splice(0,0,{value:this.formatTopicName(a.substring(1)),desc:LC.getLabel("TopicsFeed","new")}):0<c&&(a=b.splice(c,1)[0],b.splice(0,0,a));b.length>PublisherAutoComplete.TOPICS_DISPLAYED&&(b=b.splice(0,PublisherAutoComplete.TOPICS_DISPLAYED))}return b};
PublisherAutoComplete.prototype.getCaseInsensitivetMatch=function(a,b){var c,d=Sfdc.String.trim(a.substring(1).toLowerCase());for(c=0;c<b.length;c++)if(d===b[c].value.toLowerCase())return c;return-1};PublisherAutoComplete.prototype.getMaxSuggestionsToDisplay=function(){return PublisherAutoComplete.MAX_SUGGESTIONS};
PublisherAutoComplete.prototype.getCacheKey=function(a){return this.isACMention?this.currentPageFetch+a:this.hashTopicEnabled?PublisherAutoComplete.HASHTAG_KEY+Sfdc.String.trim(a):PublisherAutoComplete.HASHTAG_KEY+a.charAt(1)};PublisherAutoComplete.prototype.saveToCache=function(a,b,c){a=this.getCacheKey(a);PublisherAutoComplete.acCache.cache[a]=b;c&&0<c.length&&(PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]=c)};
PublisherAutoComplete.prototype.clearCache=function(){PublisherAutoComplete.acCache.cache={};PublisherAutoComplete.acCache.triedQueries={}};
PublisherAutoComplete.prototype.checkCacheOrRetrieve=function(a){var b=this.getCacheKey(Sfdc.String.trim(a));if(this.isACMention||this.hashTopicEnabled){if(PublisherAutoComplete.acCache.triedQueries[b])return PublisherAutoComplete.acCache.cache[b]}else if(!0===PublisherAutoComplete.acCache.retryNextQuery&&(PublisherAutoComplete.acCache.retryNextQuery=!1,PublisherAutoComplete.acCache.triedQueries[b]=null),PublisherAutoComplete.acCache.triedQueries[b])return this.getCache(b);this.retrieveFromServlet(a);
return!1};PublisherAutoComplete.prototype.getCache=function(a){if(this.isACMention||this.hashTopicEnables)return PublisherAutoComplete.acCache.cache[a];var b=[];a=PublisherAutoComplete.acCache.cache[a];var c=PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY];a&&(b=b.concat(a));c&&(b=b.concat(c));return b};
PublisherAutoComplete.prototype.handleNav=function(a){this.isACBoxVisible()&&(AutoCompleteInputElement.isNav(a)?(a.keyCode==KEY_ESC?this.clearSuggestions():a.keyCode==KEY_ARROW_U?this.selectPrev():a.keyCode==KEY_ARROW_D?this.selectNext():a.keyCode==KEY_TAB?this.handleEnter(a):a.keyCode==KEY_ENTER&&this.handleEnter(a),AutoCompleteInputElement.captureKeystroke(a)):a.keyCode==KEY_PROCESS&&(this.inKeyIME=!0))};
PublisherAutoComplete.prototype.isMention=function(a){var b=this.element,c=this.atMentionPattern,d=b.value,b=chatter.getTextUtil().getCaretLocation(b),e;switch(a){case "right":if(d.charAt(b-1)==c.end)for(a=b-1;0<=a;){if(d.charAt(a)==c.start.charAt(1)&&d.charAt(a-1)==c.start.charAt(0))return{hasMention:!0,startPos:a,endPos:b};a--}return{hasMention:!1};case "left":if(d.charAt(b)==c.start.charAt(0)&&d.charAt(b+1)==c.start.charAt(1)){a=b+2;for(e=d.length;a<e;){if(d.charAt(a)==c.end)return{hasMention:!0,
startPos:b+1,endPos:a+1};a++}}return{hasMention:!1};case "inside":for(a=b;0<a;){if(d.charAt(a)!=c.end){if(d.charAt(a)==c.start.charAt(1)&&d.charAt(a-1)==c.start.charAt(0)){e=!0;break}}else{e=!1;break}a--}if(e){j=b;for(e=d.length;j<e;){if(d.charAt(j)==c.end)return{hasMention:!0,startPos:a,endPos:j+1};j++}}return{hasMention:!1}}};
PublisherAutoComplete.prototype.showNotificationIfNeeded=function(){0<this.deniedUsers.length?chatter.getTextareaMessageUtil().showMessage({el:this.id,type:2,append:!0,msg_html:this.getPermissionErrorMessage(),msg_id:"userNotHaveAccess"}):chatter.getTextareaMessageUtil().hideMessage({el:this.id,msg_id:"userNotHaveAccess"});this.atMentions.length<PublisherAutoComplete.MAX_MENTION&&chatter.getTextareaMessageUtil().hideMessage({el:this.id,msg_id:"limitMention"})};
PublisherAutoComplete.prototype.handleEnter=function(a){this.complete()&&this.shouldCaptureKeyStroke?AutoCompleteInputElement.captureKeystroke(a):this.clearSuggestions()};PublisherAutoComplete.mouseOver=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c&&b!=c.selected&&(document.getElementById(AutoCompleteInputElement.getRowIdStatic(a,b)).className=PublisherAutoComplete.ROW_CSS_CLASS_MOUSE_OVER)};
PublisherAutoComplete.mouseOut=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c&&b!=c.selected&&(document.getElementById(AutoCompleteInputElement.getRowIdStatic(a,b)).className=PublisherAutoComplete.ROW_CSS_CLASS)};PublisherAutoComplete.click=function(a,b,c){AutoCompleteInputElement.captureKeystroke(a);Ext.isIE7?PublisherAutoComplete.clickDefered.defer(20,{},[b,c]):PublisherAutoComplete.clickDefered(b,c)};
PublisherAutoComplete.clickDefered=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c.select(b);c.complete()};PublisherAutoComplete.prototype.isValidSuggestion=function(a,b){var c=this.getRegexForInput(Sfdc.String.trim(a.substring(1)));return this.isACMention?!0:b.value.match(c)};
PublisherAutoComplete.prototype.getRegexForInput=function(a){var b=a.toLowerCase();AutoCompleteInputElement.regexCache[b]||(AutoCompleteInputElement.regexCache[b]=this.matchBlanks?RegExp(["(\\b|^|\\W)(",AutoCompleteInputElement.escapeRegex(a),")"].join(""),"gi"):RegExp(["(^)(",AutoCompleteInputElement.escapeRegex(a),")"].join(""),"gi"));return AutoCompleteInputElement.regexCache[b]};
PublisherAutoComplete.prototype.getSuggestionHtml=function(a){return this.isACMention?this.getMentionSuggestionHtml(a):this.getHashTagSuggestionHtml(a)};PublisherAutoComplete.prototype.findInput=function(a){return a};PublisherAutoComplete.prototype.compareSuggestions=function(a,b){return a&&b&&a.UserId&&b.UserId&&b.UserId==a.userId};
PublisherAutoComplete.prototype.scrollDiv=function(){if(this.hasValidSelection()&&this.scrolling){var a=this.acBox.div,b=Sfdc.Dom.getActualHeight(a,!0),c=Sfdc.Dom.getHeight(a);Sfdc.get(a);if(Sfdc.userAgent.isIE7){!PublisherAutoComplete.pageScrollHeight&&0<b&&(PublisherAutoComplete.pageScrollHeight=b,PublisherAutoComplete.heightPerSuggestion=PublisherAutoComplete.pageScrollHeight/this.curSuggestions.length);var a=PublisherAutoComplete.heightPerSuggestion,d=this.curSuggestions.length*PublisherAutoComplete.heightPerSuggestion;
d>b-a&&d<b+a||(b=d);0!==b%PublisherAutoComplete.pageScrollHeight&&(b=(this.currentPageFetch+1)*PublisherAutoComplete.pageScrollHeight);b>PublisherAutoComplete.pageScrollHeight*(PublisherAutoComplete.MAX_AUTO_FETCHES+1)&&(b=PublisherAutoComplete.pageScrollHeight*(PublisherAutoComplete.MAX_AUTO_FETCHES+1))}this.acBox.div.scrollTop=b*((this.selected+1)/this.curSuggestions.length)-0.5*c}};
PublisherAutoComplete.prototype.getACWidth=function(){return Sfdc.userAgent.isIE8?Sfdc.Dom.getWidth(this.element):this.element.clientWidth};PublisherAutoComplete.MENTION_KEY="@";PublisherAutoComplete.HASHTAG_KEY="#";PublisherAutoComplete.LIST_CSS_CLASS="publisherAC_list";PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS="autofetchloading";PublisherAutoComplete.PARAM_LOOKUP_TYPE="LookupType";PublisherAutoComplete.LOOKUP_TYPE_MENTION="ATMENTIONS";PublisherAutoComplete.LOOKUP_TYPE_HASHTAG="HASHTAGS";
PublisherAutoComplete.PARAM_HASHTAG_LIST_TYPE="HashtagListType";PublisherAutoComplete.PARAM_PAGE_NUM="PageNum";PublisherAutoComplete.PARAM_PAGE_SIZE="PageSize";PublisherAutoComplete.HASHTAG_LIST_TYPE_BOTH="BOTH";PublisherAutoComplete.HASHTAG_LIST_TYPE_POPULAR_HASHTAGS="POPULARHASHTAGS";PublisherAutoComplete.LICENSE_COUNT="LicenseCount";PublisherAutoComplete.MENTION_RESULTS="mentionSearchResults";PublisherAutoComplete.MY_HASH_TAGS="MyHashTags";PublisherAutoComplete.POPULAR_TAGS="PopularHashTags";
PublisherAutoComplete.MAX_MENTION=25;PublisherAutoComplete.MAX_SUGGESTIONS_IN_RESPONSE=100;PublisherAutoComplete.MRU_CACHE_KEY="##mru";PublisherAutoComplete.TOPIC_LENGTH=99;PublisherAutoComplete.TOPICS_DISPLAYED=3;PublisherAutoComplete.REQUEST_DELAY=300;PublisherAutoComplete.REQUEST_DELAY_LONG=1E3;PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT=0.7;PublisherAutoComplete.MAX_AUTO_FETCHES=9;PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE=50;
PublisherAutoComplete.prototype.checkCanReadFeed=function(a){var b=this,c=a.UserId;a=chatter.getFeed().config;var d;if("005"===c.substring(0,3)&&(b.feedItemParentId?d=b.feedItemParentId:a&&(d=a.subjectId),d&&"TOPIC"!==a.feedType)){var e=function(a){for(var d=b.atMentions,e=d.length-1;0<=e;e--)if(d[e].UserId==c){a||b.deniedUsers.push(d[e]);break}a||(chatter.getTextareaMessageUtil().hideMessage({el:b.id,msg_id:"userNotHaveAccess"}),chatter.getTextareaMessageUtil().showMessage({el:b.id,type:2,append:!0,
msg_html:b.getPermissionErrorMessage(),msg_id:"userNotHaveAccess"}))};d=["/feed/",d,"/",a.feedType,"/checkaccess/",c].join("");chatter.getToolbox().get({url:d,params:{visibility:this.feedItemVisibility},success:function(a,b){!1===b[c]?e(!1):e(!0)},failure:function(a,b){e(!0)}})}};PublisherAutoComplete.prototype.updateParent=function(a,b){this.feedItemParentId=a;this.feedItemParentName=b;this.recheckAccess()};
PublisherAutoComplete.prototype.cleanAtMentions=function(){for(var a=this.atMentions,b=this.atMentionPattern,c=this.getValue(),d=[],e,g,f=a.length-1;0<=f;f--)e=a[f],g=b.start+e.UserName+b.end,g=c.lastIndexOf(g),0<=g&&d.push(e);this.atMentions=d};PublisherAutoComplete.prototype.updateFeedItemVisibility=function(a){this.feedItemVisibility=a;this.recheckAccess()};
PublisherAutoComplete.prototype.recheckAccess=function(){var a=this;this.deniedUsers=[];this.cleanAtMentions();chatter.getTextareaMessageUtil().hideMessage({el:this.id,msg_id:"userNotHaveAccess"});if(this.feedItemParentId){var b=this.atMentions,c=b.length,d="";if(0<c)for(var e=0;e<c;e++)"005"===b[e].UserId.substring(0,3)&&(""!==d&&(d+=","),d+=b[e].UserId);""!==d&&chatter.getToolbox().get({url:"/feed/checkaccess/"+this.feedItemParentId,params:{idsToCheck:d,visibility:this.feedItemVisibility},success:function(d,
e){for(var h=c-1;0<=h;h--)"false"===e[b[h].UserId]&&a.deniedUsers.push(b[h]);0<a.deniedUsers.length&&chatter.getTextareaMessageUtil().showMessage({el:a.id,type:2,append:!0,msg_html:a.getPermissionErrorMessage(),msg_id:"userNotHaveAccess"})}})}};
PublisherAutoComplete.prototype.getPermissionErrorMessage=function(){var a=this.deniedUsers,b="",c=[],b={};for(i=0;i<a.length;i++)b[a[i].UserName]||(b[a[i].UserName]=a[i],c.push(b[a[i].UserName]));var d=this.feedItemVisibility,b=function(){var a,b=c.length;a=!d||chatter.getPublisher().FEEDITEM_VISIBILITY_ALL_USERS===d?1===b?LC.getLabel("PublisherAutoComplete","allCannotReadNoEntitySingular"):LC.getLabel("PublisherAutoComplete","allCannotReadNoEntityPlural"):1===b?LC.getLabel("PublisherAutoComplete",
"internalExternalCannotSeeUpdateSingular"):LC.getLabel("PublisherAutoComplete","internalExternalCannotSeeUpdatePlural");if(1===b)return a.replace("{0}",c[0].UserName);if(2===b)return a=a.replace("{0}",c[0].UserName),a.replace("{1}",c[1].UserName);for(var b="",f=0;f<c.length-1;)b+=c[f].UserName+", ",f++;b=b.substring(0,b.length-1);a=a.replace("{0}",b);return a.replace("{1}",c[c.length-1].UserName)}();return escapeHTML(b)};PublisherAutoComplete.prototype.getNumInsertedMentions=function(){return this.atMentions.length};
PublisherAutoComplete.prototype.getNumValidMentions=function(){for(var a=0,b=this.element.value,c=this.atMentions,d=this.atMentionPattern,e=c.length-1;0<=e;e--){var g=d.start+c[e].UserName+d.end,f=b.lastIndexOf(g);0<=f?(l=g.length,b=b.substr(0,f)+b.substr(f+l),a++):this.atMentions.splice(e,1)}return a};
PublisherAutoComplete.prototype.hasReachedMaxMentions=function(){return this.getNumInsertedMentions()>=PublisherAutoComplete.MAX_MENTION?this.getNumValidMentions()>=PublisherAutoComplete.MAX_MENTION:!1};PublisherAutoComplete.prototype.createMention=function(a){var b=this.atMentionPattern;return b.start+a.UserName+b.end+""};PublisherAutoComplete.prototype.createHashtag=function(a){var b=this.hashMentionPattern;return this.hashTopicEnabled?b.start+a.value+b.end+" ":a.value};
PublisherAutoComplete.prototype.displayHelpACBox=function(){this.element&&(this.acBox||this.initACBox(),this.setACBox(this.getACHelpHTML()),this.positionACBox(),this.setACBoxHeight(1),this.showACBox(),this.updateWidth())};
PublisherAutoComplete.prototype.getACHelpHTML=function(){if(this.isACMention){var a=this.groupAtMentionsEnabled?LC.getLabel("PublisherAutoComplete","typeMentionUserAndGroup"):LC.getLabel("PublisherAutoComplete","typeMentionUserOnly");return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',a,"\x3c/div\x3e"]}return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',LC.getLabel("PublisherAutoComplete","typeSomethingHashTag"),"\x3c/div\x3e"]};
PublisherAutoComplete.prototype.getHashTagSuggestionHtml=function(a){var b=Sfdc.String.trim(escapeHTML(this.lastInput));a=escapeHTML(a.value);b=this.getRegexForInput(b.substring(1));return a.replace(b,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e')};
PublisherAutoComplete.prototype.getMentionSuggestionHtml=function(a){var b=escapeHTML(this.lastInput),c=escapeHTML(a.UserName),d=escapeHTML(a.Title),b=this.getRegexForInput(b.substring(1)),c=c.replace(b,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e');return[a.ImageHtml,"\x26nbsp;\x3cspan class\x3d'name'\x3e",c,"\x3c/span\x3e",a.BadgeHtml," \x3cspan class\x3d'publisherAC_userRole'\x3e",d,"\x3c/span\x3e"].join("")};
PublisherAutoComplete.prototype.getRowEl=function(a){return Ext.get(AutoCompleteInputElement.getRowIdStatic(this.id,a))};
PublisherAutoComplete.prototype.getWordToComplete=function(){var a=this.getValue(),b=this.textUtil.getCaretLocation(this.element);if(this.isACBoxVisible()){var c=a.charAt(this.indexStartAC);return this.isACMention&&c!=PublisherAutoComplete.MENTION_KEY||!this.isACMention&&c!=PublisherAutoComplete.HASHTAG_KEY?"":a.slice(this.indexStartAC,b)}c=PublisherAutoComplete.getWordToCompleteStartIndex(a,b);return 0<=c?(this.indexStartAC=c,a=a.slice(this.indexStartAC,b),0<a.length&&(a.charAt(0)==PublisherAutoComplete.MENTION_KEY?
this.isACMention=!0:this.isACMention=!1),a):""};PublisherAutoComplete.prototype.getAtMentionsPlainTextCount=function(a){var b=0,c=a.length;if(0!==c){for(var d=0;d<c;d++)b+=a[d].UserName.length;b+=this.atMentionPattern.start.length*c;b+=this.atMentionPattern.end.length*c}return b};
PublisherAutoComplete.prototype.getInputValueLength=function(){var a=0;this.element&&(this.atMentions&&0<this.atMentions.length)&&(a=21*this.atMentions.length-this.getAtMentionsPlainTextCount(this.atMentions));return this.element.value.length+a};PublisherAutoComplete.prototype.toggleExternalGroupWarning=function(a){var b=Ext.get(this.element.id);b&&a?b.addClass("externalGroupInput"):b.removeClass("externalGroupInput")};
PublisherAutoComplete.prototype.appendPageFromCacheOrServlet=function(a){this.currentPageFetch>PublisherAutoComplete.MAX_AUTO_FETCHES?this.fetchingPage=!1:this.checkCacheOrRetrieve(a)&&this.appendSuggestions()};
PublisherAutoComplete.prototype.appendSuggestions=function(){if(this.element){var a=this.lastInput,b=this.id,c=this.isACMention&&this.hasReachedMaxMentions(),d=chatter.getTextareaMessageUtil().isMessageDisplayed(b,"limitMention");if(c!==d){if(c){chatter.getTextareaMessageUtil().showMessage({el:b,type:2,append:!0,msg_html:LC.getLabel("PublisherAutoComplete","limitMention",PublisherAutoComplete.MAX_MENTION),msg_id:"limitMention"});return}chatter.getTextareaMessageUtil().hideMessage({el:textAreaId,msg_id:"limitMention"})}b=
null;this.hasValidSelection()&&(b=this.curSuggestions[this.selected],a=this.getSuggestions(a),this.curSuggestions.push.apply(this.curSuggestions,a),acList=Sfdc.get("."+PublisherAutoComplete.LIST_CSS_CLASS,this.acBox.div),c=[],this.addSuggestions(c,a,b,this.currentPageFetch*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE),acList.innerHTML+=c.join(""),this.loadingScreen.hide(),this.fetchingPage=!1,this.curSuggestions.length<(this.currentPageFetch+1)*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE&&(this.allResultsReturned=
!0),Sfdc.userAgent.isIE7&&(PublisherAutoComplete.pageScrollHeight&&(acList.style.height=PublisherAutoComplete.pageScrollHeight*(this.currentPageFetch+1)),a=0>=this.currentPageFetch-1?1:this.currentPageFetch-1,a=a*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE*PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT,this.selected+1>a&&this.scrollDiv()))}};PublisherAutoComplete.isValidBefore=function(a){return"\u00a0"==a||-1!=" .,;:)(\x26!'\"`?|\\\n%-_+\x3d$^~[]{}\x3c\x3e*\t\u200f\u200e".indexOf(a)};
PublisherAutoComplete.acCache={cache:{},triedQueries:{}};PublisherAutoComplete.getWordToCompleteStartIndex=function(a,b){for(var c=0,d,e=!0,g=!0,f=b-1;0<=f&&(e||g);f--)if(d=a.charAt(f),/\s/.test(d))c++,3<=c&&(g=e=!1);else if("]"==d)e=!1;else if(d==PublisherAutoComplete.MENTION_KEY){if(e&&(0===f||PublisherAutoComplete.isValidBefore(a.charAt(f-1))))return f}else if(d==PublisherAutoComplete.HASHTAG_KEY&&g&&(0===f||PublisherAutoComplete.isValidBefore(a.charAt(f-1))))return f;return-1};
function getRechatParent(c){return Ext.get("rechatBodyContainer"+c)}function removeCustomerGroupMessage(c){c=getRechatParent(c);c.child("div.selectionBlock").removeClass("customerGroup");chatter.getToolbox().hide(c.child(".customerGroupMessage"))}
function RechatHelper(c,b,g,k){var d=this,f=chatter.getToolbox(),a=getRechatParent(b),e=function(c,d){var e=a.child(".rechatResponseMessage");e.update(c);e.addClass(d);f.hide(a.child(".rechatBody"));f.show(a.child(".rechatResponseMessageContainer"))};this.dialogContents=a;this.feedItemId=c;this.shareButton=a.child(".rechatShareButton");this.shareButton.removeAllListeners();this.shareButton.on("click",function(){d.submit()});Sfdc.userAgent.isIE7&&(Sfdc.on(this.shareButton.dom,"mouseover",function(){Sfdc.Dom.addClass(d.shareButton.dom,
"onHover")}),Sfdc.on(this.shareButton.dom,"mouseout",function(){Sfdc.Dom.removeClass(d.shareButton.dom,"onHover")}));this.textarea=a.child("textarea.cxrechatcommenttextarea").dom;this.isContentPost=a.child(".rechatSharing");this.fireOnAfterPreviewLoaded=function(){chatter.getEventBus().fireEvent("chatter:rechat","onAfterPreviewLoaded",{})};this.commit=function(){var c=d.dialogContents.child("textarea.cxrechatcommenttextarea").dom;f.disable(c);var a=chatter.getFeed().getCommentElement(c.id),b;a&&(b=
a.getInputWithEncodedAtMentions());a={newParentId:d.getParentId(),commentText:b};b=k?(window.opener?window.opener:window.parent).chatter:chatter;var g=b.getEventBus(),h=b.getFeed(),l="NEWS"===h.config.feedType&&(!h.filter||"all"===h.filter);l&&(a.showNewFeedItem=!0,a.feedType=h.getConfig().feedType,a.pollingToken=chatter.getFeed().getPollToken(),g.fireEvent("chatter:feed","onBeforeRechat"));f.disableButton(d.shareButton.dom);f.post({url:"/feeditems/"+d.feedItemId+"/rechats",params:a,success:function(c,
a){var b=d.createSuccessMessage(a.parentDetailURL);e(b,"success");l&&a.feedItem&&(g.fireEvent("chatter:feed","onBeforeNewPostFeedUpdate",{json:a}),b=h.addFeedItem(a.feedItem),g.fireEvent("chatter:feed","onAfterNewPostFeedUpdate",{json:a,feedItem:b}))},failure:function(a,b){f.enable(c);f.enableButton(d.shareButton);b&&(b.errors&&b.errors.rechatErrorMessage)&&e(b.errors.rechatErrorMessage,"failed")}})};this.closeDialog=function(){(k?window.opener?window.opener:window.parent:window).chatter.getModalOverlay(g).closeDialog()};
this.submit=function(){d.commit()};this.updateCommentArea=function(a,c){var b=chatter.getFeed().getCommentElement(d.textarea.id);a||(c=a="");if(b)b.updateParent(a,c);else{var b=Sfdc.get(".cxfeeditem",d.dialogContents.dom),e=chatter.getFeed().getFeedItemData(b);e.parentid=a;e.parentname=c;e=Sfdc.JSON.stringify(e);b.setAttribute("data-feeditem",e)}};this.getParentId=function(){return null};this.createSuccessMessage=function(a){return null}}Ext.ns("Sfdc.RechatComposer.RechatToFollowersHelper");
Sfdc.RechatComposer.RechatToFollowersHelper=function(c,b,g,k,d){Sfdc.RechatComposer.RechatToFollowersHelper.superclass.constructor.call(this,c,b,g,d);var f=chatter.getToolbox();f.enableButton(this.shareButton.dom);removeCustomerGroupMessage(b);this.updateCommentArea(UserContext.userId,LC.getLabel("Publisher","UserLabel"));this.getParentId=function(){return k};this.createSuccessMessage=function(a){var b=f.htmlEncode(LC.getLabel("Feeds","RechatSuccessToFollowers"));return LC.getLabel("Feeds","RechatSuccessMessage",
a,b,b,b)}};Ext.extend(Sfdc.RechatComposer.RechatToFollowersHelper,RechatHelper);Ext.ns("Sfdc.RechatComposer.RechatToGroupHelper");
Sfdc.RechatComposer.RechatToGroupHelper=function(c,b,g,k){var d,f;function a(a){f=d=null;Ext.get("recipientSelectionContainer"+a)&&Ext.get("recipientSelectionContainer"+a).parent().remove();r.setDisplayed(!0);removeCustomerGroupMessage(a);n();q();h.updateCommentArea()}function e(a,c){var d=LC.getLabel("Publisher","GroupRemoveBtn");return"\x3cdiv id\x3d'recipientSelectionContainer"+b+"' class\x3d'recipientSelectionContainer'\x3e\x3cdiv class\x3d'groupicon'\x3e"+c.replace("chatter-avatarMedium","chatter-avatarSmall")+
"\x3c/div\x3e\x3cdiv class\x3d'groupinfo'\x3e"+a+"\x3c/div\x3e\x3cdiv class\x3d'removegroup'\x3e\x3ca href\x3d'#' class\x3d'remove' title\x3d'"+d+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"}function n(){var a=chatter.getToolbox(),b=d;b?chatter.getTextareaMessageUtil().enableSubmitButtonIfNoErrorsInternal(h.textarea.id,h.shareButton.dom):a.disableButton(h.shareButton);return b}function q(){var a=Ext.get(l);a.addClass("ghostText");a.dom.value=LC.getLabel("Feeds","RechatWithGroupGhostText")}function s(a){a=
getRechatParent(a);a.child("div.selectionBlock").addClass("customerGroup");chatter.getToolbox().show(a.child(".customerGroupMessage"))}function t(a,b,c,g,k,l){null===d&&(d=a,f=b,m.parent(),r.setDisplayed(!1),u.createChild({tag:"div",cls:"grpSelect",html:e(b,g)}).select(".remove").addListener("click",function(a,b){h.removeRecipient(l);a.stopEvent();a.stopPropagation()}),k&&s(l),n(),m.blur(),h.updateCommentArea(a,LC.getLabel("Publisher","CollaborationGroupLabel")))}Sfdc.RechatComposer.RechatToGroupHelper.superclass.constructor.call(this,
c,b,g,k);c=getRechatParent(b);var h=this;g=chatter.getToolbox();f=d=null;var l="rechatRecipientInputBox"+b,m=c.child(".rechatRecipientInput"),p=c.child(".rechatRecipientListCls"),r=c.child(".rechatRecipientsContainer"),u=c.child(".rechatRecipientSelector");c.child(".recipientSelectionContainer")&&a(b);this.updateCommentArea();g.disableButton(h.shareButton.dom);new UserAndGroupAutoCompleteInputElement({elementId:l,zIndex:6E4,inDialog:!0,disableGhostText:!0,entityType:UserAndGroupAutoCompleteInputElement.ENTITY_TYPE_GROUP,
fixedACYPosition:0,handleBlur:function(){this.clearSuggestions()},handleSelect:function(a){t(a.itemId,a.itemName,a.itemTitle,a.imageHtml,a.isExternalUserOrGroup,b);this.complete()},getACXPosition:function(){return p.getX()},getACYPosition:function(){return p.getY()+p.getHeight()},getMinimumWidth:function(){return 350}});m.on({keydown:{fn:function(a){a.keyCode==KEY_TAB&&shareButton.focus()}},focus:{fn:function(){m.addClass("focus")}},blur:{fn:function(){m.removeClass("focus");q()}}});this.createSuccessMessage=
function(a){var b=f;return LC.getLabel("Feeds","RechatSuccessMessage",a,b,b,b)};this.submit=function(){n()&&h.commit()};this.getParentId=function(){return d};this.removeRecipient=function(b){a(b)}};Ext.extend(Sfdc.RechatComposer.RechatToGroupHelper,RechatHelper);Ext.ns("Sfdc.RechatComposer.RechatTargetSelector");
Sfdc.RechatComposer.RechatTargetSelector=function(c,b,g,k,d,f){var a=chatter.getToolbox(),e=getRechatParent(g);"followers"==c?(a.hide(e.child(".rechatViaLink")),a.show(e.child(".followersAndGroupContainer")),a.hide(e.child(".rechatWithGroup")),Sfdc.RechatComposer.RechatToFollowersHelper(b,g,k,d,f)):"group"==c?(a.show(e.child(".rechatWithGroup")),Sfdc.RechatComposer.RechatToGroupHelper(b,g,k,f)):"link"==c?(a.show(e.child(".rechatViaLink")),a.hide(e.child(".followersAndGroupContainer")),e.child(".rechatUrlCls").dom.focus()):
"backtoprevious"==c&&(a.hide(e.child(".rechatViaLink")),a.show(e.child(".followersAndGroupContainer")));return!1};
(function(){function k(a,b){return a?Sfdc.get(".chatterListOverlay"):Sfdc.get(".chatterListOverlay",Sfdc.get(b))}function f(a,b,e,c,d,g,h){var f=Sfdc.get(".chatterListOverlayContents",k(a,b)),l=chatter.getToolbox();l.get({url:c,params:{q:d,i:e,keyPrefix:g,pageNumber:h,dialogId:b},success:function(a,b){Sfdc.Dom.updateHTML(f,b.html);l.fixIE7Haslayout(f)}})}Sfdc.provide("SfdcApp.Chatter.FollowListOverlay",{closeDialog:function(a){chatter.getToolbox().get({params:{q:";updatefollowing",id:a},success:function(b,
a){var c=Sfdc.get("followingPanel"),d=c.ownerDocument.createElement("div");d.innerHTML=Sfdc.String.trim(a.html);c.parentNode.insertBefore(d.firstChild,c);Sfdc.Dom.removeChild(c)}})},prevPage:function(a,b,e,c,d,g,h){f(a,b,e,c,d,g,h-1)},nextPage:function(a,b,e,c,d,g,h){f(a,b,e,c,d,g,h+1)},filter:function(a,b,e,c){var d=Sfdc.get(".picklistFilter",k(a,b));f(a,b,e,null,c,d.value,0)}})})();
(function(){function c(a,b,d,e){var c=Sfdc.get(".chatterListOverlayContents",!a?Sfdc.get(".chatterListOverlay",Sfdc.get(b)):Sfdc.get(".chatterListOverlay")),f=chatter.getToolbox();f.get({url:d,params:e,success:function(a){Sfdc.Dom.updateHTML(c,a.responseText);f.fixIE7Haslayout(c)}})}Sfdc.provide("SfdcApp.Chatter.GroupListOverlay",{closeDialog:function(a,b){return(a?window.opener?window.opener:window.parent:window).sfdcPage.getDialogById(b).cancel()},nextPage:function(a,b,d,e){c(a,b,d,{p:e+1})},prevPage:function(a,
b,d,e){c(a,b,d,{p:e-1})}})})();
(function(){SfdcApp.Chatter.SubscribeButton={_toggle:function(d,b){var a=Sfdc.select("\x3e *",d),c=a[0],a=a[1];Sfdc.Dom.show(b?a:c);Sfdc.Dom.hideByDisplay(b?c:a)},onHover:function(d,b){var a=Sfdc.Event.getEventTarget(d,"."+ZenCss.mediaBody);a&&(a=Sfdc.get(a,".chatter-unfollowIcon"),b?Sfdc.Dom.addClass(a,"active"):Sfdc.Dom.removeClass(a,"active"))},onKeyUp:function(d,b){if(Sfdc.Event.isKeyAction(d,Sfdc.Event.keyCode.ENTER))SfdcApp.Chatter.SubscribeButton.onClick(d,b)},onClick:function(d,b){var a=Sfdc.Event.getEventTarget(Sfdc.Event.getEvent(d),
"[data-chatter-subscribe]");!a&&b&&(a=Sfdc.select("[data-chatter-subscribe]",b),a="none"===Sfdc.Dom.getStyle(a[0],"display")?a[1]:a[0]);if(a){var c=Sfdc.Dom.getParent(a,"[data-chatter-widget\x3dsubscribeBtn]"),e=c.getAttribute("data-sfdc-entity-id"),g=c.getAttribute("data-sfdc-network-id");if(!Sfdc.Data.get(c,"chatter:subscribing")){Sfdc.Data.set(c,"chatter:subscribing",!0);var f="1"===a.getAttribute("data-chatter-subscribe");f?omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().follow):omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().unfollow);
var a=!1,h=Sfdc.resolve("SfdcApp.Recommend.JitRecsPanel");h&&(a=h.hasJitRecs(e));var k=this;chatter.getToolbox().post({url:"/subscriptions/"+e+(f?";new":";delete"),params:{entityid:e,jitRecs:a,networkId:g},failure:function(){Sfdc.Data.clear(c,"chatter:subscribing")},success:function(a,b){Sfdc.Data.clear(c,"chatter:subscribing");Sfdc.each(Sfdc.select("[data-chatter-widget\x3dsubscribeBtn][data-sfdc-entity-id\x3d"+e+"][data-sfdc-network-id\x3d"+g+"]"),function(a){this._toggle(a,f)},k);chatter.getEventBus().fireEvent("chatter:FollowUnfollow",
f?"onAfterFollow":"onAfterUnfollow",{entityId:e,networkId:g,target:c,followersHtml:b.html,jitRecs:b.jitRecs,jitRecsInit:b.jitRecsInit});return!1}})}}}}})();
Sfdc.provide("SfdcApp.ChatterHoverUtil",function(){var l={},h={DOWNLOAD:{selector:".downloadItemIcon",checkPrevious:!0},UNFOLLOW:{selector:"[data-chatter-subscribe\x3d0]",checkPrevious:!1},FOLLOW:{selector:"[data-chatter-subscribe\x3d1]",checkPrevious:!1},SHARE:{selector:".shareFileWithItemIcon",checkPrevious:!0},MESSAGE:{selector:".openPrivateMessageDialog",checkPrevious:!1},UPLOAD:{selector:".chatterFileUploadNewVersionAction",checkPrevious:!0},CHAT:{selector:".chat",checkPrevious:!1},JOIN:{selector:".asktojoin",
checkPrevious:!1},UNJOIN:{selector:".member",checkPrevious:!1}},m=!0;chatter.getEventBus().addEventListener("chatter:hover","onAfterShowNow",function(a,b){var c=b.entityId;l[c]||(l[c]=!0,Sfdc.logServer("chatterHover",{event:"O",entityId:c}))});return{handlePreviewLoad:function(a){a=Sfdc.select("img",Sfdc.get(a))[0];var b=Sfdc.Dom.getParent(a,".thumbHover"),c=Sfdc.Dom.getNext(b,".thumbHover");if(a.complete)Sfdc.Dom.hideByDisplay(c),Sfdc.Dom.show(b);else Sfdc.on(a,"load",function(){Sfdc.Dom.hideByDisplay(c);
Sfdc.Dom.show(b)})},addChatterCoreCssIfNeeded:function(){if(m){for(var a=document.getElementsByTagName("link"),b=a.length,c=-1,d=!1,f,g=0;g<b&&!d;g++){var e=a[g].href;e&&(d=-1!==e.indexOf("chatterCore.css"),f||(c=e.indexOf("common.css"),-1!==c&&(f=e.substring(0,c))))}!d&&f&&Sfdc.Resource.addCSS(f+"chatterCore.css")}m=!1},onActionClick:function(a,b,c){var d,f=!1,g=Sfdc.Dom,e,k;a=Sfdc.Event.getEventTarget(b);for(d in h)if(h.hasOwnProperty(d)){k=h[d].selector;e=a;for(b=0;4>b;b++){if(g.isMatch(e,k)){f=
!0;break}e=e.parentNode}if(f||h[d].checkPrevious&&g.getPrevious(a,k))return Sfdc.logServer("chatterHover",{event:"A",entityId:c,ac:d})}}}}());
Sfdc.ns("SfdcApp.ChatterGroupMembership");
SfdcApp.ChatterGroupMembership=function(){function k(a){return Sfdc.Dom.getParent(a,".groupmembership")}function l(a,c){var b;if(Sfdc.isArray(a))for(b=a.length;b--;)l(a[b],c);else a.innerHTML=Sfdc.String.getIntValue(a.innerHTML,10)+(c?1:-1)}function p(a,c,b){b=Sfdc.select("[data-gid\x3d"+b+"] .membercount");if(b.length)l(b,c);else if(b=Sfdc.get(".membercount",Sfdc.Dom.getParent(a,"tr"))){l(b,c);return}a=Sfdc.Dom.getParent(a,".groupManagementContainer");null!==a&&Sfdc.each(Sfdc.select(".groupmembercount",
a),function(a){l(a,c)})}function m(a,c,b){a=Sfdc.Dom.getParent(a,".groupManagementContainer");if(null!==a){b.message&&alert(b.message);for(var d=0;d<b.htmllist.length;d++)for(var f=b.htmllist[d],e=f.html,f=f.idlist,g=0;g<f.length;g++)Sfdc.get(".request_"+f[g]+" .memberTableRole",a).innerHTML=e;Sfdc.each(Sfdc.select(".groupmemberrequestcount",a),function(a){a.innerHTML=Sfdc.String.getIntValue(a.innerHTML)-c.length});Sfdc.each(Sfdc.select(".groupmembercount",a),function(a){a.innerHTML=Sfdc.String.getIntValue(a.innerHTML)+
b.acceptedcount});Sfdc.each(Sfdc.select("input.acceptAll"),function(a){if(1==c.length){var b=Sfdc.String.getIntValue(a.getAttribute("count_page_request"))-1;if(3>b)q();else{var d=Sfdc.JSON.parse(a.getAttribute("requests"));d.remove(c[0]);a.setAttribute("requests",'["'+d.join('","')+'"]');d=Sfdc.String.getIntValue(a.getAttribute("count_total_request"))-1;a.setAttribute("count_total_request",d);a.setAttribute("count_page_request",b);a.setAttribute("value",LC.getLabel("ChatterGroups","membership_admin_acceptall",
b,d));a.setAttribute("title",LC.getLabel("ChatterGroups","membership_admin_acceptall_title",b,d))}}else q()})}}function q(){Sfdc.each(Sfdc.select("input.acceptAll"),function(a){Ext.get(a).slideOut("t",{easing:"easeOut",duration:0.5,remove:!0,callback:function(){Ext.select("tr.acceptAll").remove()}})})}var h=!1,r=!1,n="",s={onHover:function(a,c){var b=k(a),b=Sfdc.get(".actionIcon",b);c?Sfdc.Dom.addClass(b,"active"):Sfdc.Dom.removeClass(b,"active")},asktojoin:function(a,c){var b=chatter.getToolbox(),
d=Ext.get(a);b.mask(d);var f=k(a),e={};e.style=c.style;b.post({url:"/groups/"+c.groupId+"/memberrequests;create",params:e,success:function(a,d){h=!0;d.message&&alert(d.message);c.refresh?b.refresh():Sfdc.Dom.getParent(f).innerHTML=d.html},failure:function(a,c){b.unmask(d)}})},withdrawRequest:function(a,c){if(!confirm(LC.getLabel("ChatterGroups","membership_request_withdraw_confirm")))return!1;var b=Ext.get(a),d=chatter.getToolbox();d.mask(b);var f=k(a),e={};e.style=c.style;d.post({url:"/groups/"+
c.groupId+"/memberrequests;delete",params:e,success:function(a,b){h=!0;b.message&&alert(b.message);c.refresh?d.refresh():Sfdc.Dom.getParent(f).innerHTML=b.html},failure:function(a,c){d.unmask(b)}})},acceptAll:function(a,c){var b=chatter.getToolbox();b.disableButton(a);var d={};d.userId=c.userId;d.requestIds=c.requestIds;d.status=c.status;d.style=c.style;d.accept=!0;b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",params:d,success:function(d,e){h=!0;c.refresh?b.refresh():m(a,c.requestIds,e)},
failure:function(a,c){403==a.status&&b.refresh()}})},actOnAcceptRequest:function(a,c){var b=chatter.getToolbox(),d=k(a),f=Sfdc.get(".accept",d),e=Ext.get(Sfdc.get(".decline",d));b.disableButton(f);b.mask(e);var g={};g.userId=c.userId;g.requestIds=c.requestIds;g.status="accepted";g.style=c.style;g.filter=SfdcApp.ChatterGroupAddRemoveMemberOverlay.getCurrentFilter();b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",params:g,success:function(a,e){h=!0;if(c.refresh)b.refresh();else{var f=Sfdc.Dom.getParent(d);
m(f,c.requestIds,e)}},failure:function(a,c){403==a.status&&b.refresh();b.enableButton(f);b.unmask(e)}})},onFocusDeclineMessage:function(a){Sfdc.Dom.removeClass(a,"unfocus");Sfdc.String.trim(a.value)==LC.getLabel("ChatterGroups","membership_request_optional_msg")&&(a.value="")},toggleDeclineDetails:function(a){var c=chatter.getToolbox(),b=Sfdc.Dom.getParent(a,".overlayDialog");a=Sfdc.Dom.getParent(a,"tr");var d=Sfdc.Dom.hasClass(a,"declineExpanded");Sfdc.Dom.toggleClass(a,"declineExpanded");d?(Sfdc.Dom.show(Sfdc.select(".memberTableName, .memberTableRole",
a)),Sfdc.Dom.hideByDisplay(Sfdc.select(".declineDetails",a))):(Sfdc.Dom.show(Sfdc.select(".declineDetails",a)),Sfdc.Dom.hideByDisplay(Sfdc.select(".memberTableName, .memberTableRole",a)));Sfdc.each(Sfdc.select(".btn",b),function(a){!Sfdc.Dom.hasClass(a,"declineSend")&&!Sfdc.Dom.hasClass(a,"declineCancel")&&(d?c.enableButton(a):c.disableButton(a))});var f=Sfdc.get(".quickfindInput",b);d?c.enable(f):c.disable(f);Sfdc.each(Sfdc.select("a",b),function(a){a=Ext.get(a);d?c.unmask(a):c.mask(a)});Sfdc.each(Sfdc.select("img",
b),function(a){d?(a.setAttribute("onclick",a.getAttribute("onclickold")),a.removeAttribute("onclickold")):(a.setAttribute("onclickold",a.getAttribute("onclick")),a.setAttribute("onclick","return false;"))});d||a.scrollIntoView(!0)},actOnDeclineRequest:function(a,c){var b=chatter.getToolbox(),d={};d.userId=c.userId;d.requestIds=c.requestIds;d.status="declined";d.style=c.style;d.filter=SfdcApp.ChatterGroupAddRemoveMemberOverlay.getCurrentFilter();var f=Sfdc.get(".responseMessage",Sfdc.Dom.getParent(a,
".declineDetails")).value;Sfdc.String.trim(f)!=LC.getLabel("ChatterGroups","membership_request_optional_msg")&&(d.responseMessage=f);b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",params:d,success:function(d,f){h=!0;if(c.refresh)b.refresh();else{s.toggleDeclineDetails(a);var t=Sfdc.Dom.getParent(Sfdc.get(".groupmembership",Sfdc.Dom.getParent(a,"tr")));m(t,c.requestIds,f)}},failure:function(a,c){403==a.status&&b.refresh()}})},join:function(a,c){var b=chatter.getToolbox(),d=Ext.get(a);d.is("input")?
b.disableButton(d.dom):b.mask(d);var f=k(a),e={};c.onBehalfOf&&(e.userId=c.onBehalfOf);e.style=c.style;omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().joinGroup);Perf.mark("createGroupMember");b.post({url:"/groups/"+c.groupId+"/members;create",params:e,success:function(a,d){h=!0;d.message&&alert(d.message);if(c.refresh)b.refresh();else{var e=Sfdc.Dom.getParent(f);e.innerHTML=d.html;chatter.getEventBus().fireEvent("chatter:joinGroup","onAfterJoin",{entityId:c.groupId,target:e});p(e,!0,c.groupId)}},
failure:function(a,c){d.is("input")?(b.enableButton(d),403==a.status&&b.refresh()):b.unmask(d)}})},leave:function(a,c){if(c.onBehalfOf){if(!confirm(LC.getLabel("ChatterGroups","membership_remove_confirm")))return!1}else if(!confirm(LC.getLabel("ChatterGroups","membership_leave_confirm")))return!1;var b=Ext.get(a),d=chatter.getToolbox();d.mask(b);var f=k(a),e={};chatter.getToolbox().stringIsEmpty(n)||(e.currentUserProfileId=n);c.onBehalfOf&&(e.userId=c.onBehalfOf);e.style=c.style;omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().unjoinGroup);
Perf.mark("removeGroupMember");d.post({url:"/groups/"+c.groupId+"/members;delete",params:e,success:function(a,b){h=!0;b.message&&alert(b.message);if(b.url)chatter.getToolbox().navigateTo(b.url);else if(c.refresh)d.refresh();else{var e=Sfdc.Dom.getParent(f);e.innerHTML=b.html;chatter.getEventBus().fireEvent("chatter:leaveGroup","onAfterLeave");p(e,!1,c.groupId)}},failure:function(a,c){d.unmask(b)}})},isDirty:function(){return h},disableRefreshOnClose:function(){r=!0},isDisableRefresOnClose:function(){return r},
setCurrentUserProfileId:function(a){n=a}};return s}();
Sfdc.provide("SfdcApp.Recommend",function(){function h(){this.data=[];this.requestInProgress=!1}function l(a){a=a||{};this.id=a.id||null;this.clientSideCache=new h;this.recType=null;this.idsAlreadyHave=[];this.isPage=!1;this.hiddenDiv=null;this.isInit=!1;this.bindEvents();chatter.getEventBus().addEventListener("chatter:feed","onAfterFeedRefresh",this.bindEvents,this);chatter.getEventBus().addEventListener("chatter:navigation","onAfterHtmlUpdate",this.bindEvents,this);chatter.getEventBus().addEventListener("chatter:feed",
"onBeforeRemoveFeed",this.unbindEvents,this)}var g,d={REC_TYPES:"data-rectype",REC_ID:"data-recid",PROC_NAME:"data-recprocname",EXPLAIN_TYPE:"data-explaintype",PURPOSE:"data-purpose"};h.prototype={store:function(a){Array.prototype.push.apply(this.data,a)},get:function(a,b){var c=this.data.shift(),e=this;!c&&!this.requestInProgress?(this.requestInProgress=!0,chatter.getToolbox().post({url:a.url,params:a.params,success:function(c,d){e.requestInProgress=!1;d.extraRecs&&e.store(d.extraRecs);a.success.call(b,
e.data.shift(),d.extraRecs)},failure:function(){e.requestInProgress=!1;a.failure&&a.failure.apply(b,arguments)}})):a.success.call(b,c,[])},remove:function(a){a=Sfdc.Array.indexOf(this.data,a);return-1!==a?this.data.splice(a,1):!1}};l.prototype={smoothReplace:function(a,b,c,e){c&&(c=Sfdc.Function.bind(c,e));Sfdc.Dom.hideByVisibility(b);a.parentNode.insertBefore(b,a);Sfdc.Dom.removeChild(a);Sfdc.Effects.fadeIn(b,c)},fadeOutFadeIn:function(a,b,c,e){var d=this;Sfdc.Effects.fadeOut(a,function(){d.smoothReplace(a,
b,c,e)})},rejectRec:function(a){Sfdc.get("ReadOnlyBanner")?alert(LC.getLabel("Exception","InvalidReadOnlyUserDmlException_desc")):this.replaceRec(a,a.getAttribute(d.REC_ID))},explainRec:function(a,b){var c=Sfdc.Dom.getNext(a,".recExpl");c&&(Sfdc.Data.get(a,"clicked")?Sfdc.Dom.isVisible(c)?Sfdc.Dom.hideByDisplay(c):Sfdc.Dom.show(c):(Sfdc.Data.set(a,"clicked",!0),chatter.getToolbox().post({url:"/recommended/explain/"+b,params:{explaintype:a.getAttribute(d.EXPLAIN_TYPE)},success:function(a,b){c.innerHTML+=
b.html;Sfdc.Dom.show(c)}})))},onAccepted:function(a,b){Sfdc.get(this.id)&&this.replaceRec(b.target,b.entityId,!0)},getNoMoreRecsElement:function(){var a=Sfdc.get(this.id).ownerDocument.createElement("span");a.className="noMoreRecs";a.innerHTML=LC.getLabel("RecommendedGeneral","no_recs")||"";this.getNoMoreRecsElement=function(){return a};return a},doRemoveRecElement:function(a){Sfdc.Dom.removeChild(a)},removeRecElement:function(a){this.doRemoveRecElement(a);this.isEmpty()&&(this.unbindEvents(),this.fadeOutFadeIn(Sfdc.get("#"+
this.id+" .recBox"),this.getNoMoreRecsElement()))},isEmpty:function(){return!Sfdc.select("#"+this.id+" .recElement").length},extractRecElement:function(a,b,c){var e=null,e=Sfdc.Dom.isMatch(a,".recElement")?a:Sfdc.Dom.getParent(a,".recElement");!e&&(c&&-1<this.idsAlreadyHave.indexOf(b))&&(a=Sfdc.select("#"+this.id+" *["+d.REC_ID+"\x3d"+b+"]"),a.length&&(e=a[0]));return e},reportAction:function(a,b,c,e,d){chatter.getToolbox().post({url:"/recommended/"+(e?"accept":"reject")+"/"+c,params:{uri:window.location.pathname,
purpose:a,nextrec:d?d.id:null,procname:b}})},hideRecElement:function(a,b){var c=this;Sfdc.Effects.fadeOut(a,function(){b.call(c,a,a.getAttribute(d.PURPOSE),a.getAttribute(d.PROC_NAME))})},showNewRecElement:function(a,b){this.smoothReplace(b,a,function(){this.isPage||chatter.getEventBus().fireEvent("chatter:hover","onAfterUpdate",{container:a})},this)},replaceRec:function(a,b,c){this.isInit||this.init();if(!this.clientSideCache.remove(b)&&(a=this.extractRecElement(a,b,c)))Sfdc.Dom.addClass(a,"recBlueBg"),
this.hideRecElement(a,function(a,d,g){this.clientSideCache.get({url:"/recommend/"+this.recType,params:{idsAlreadyHave:this.idsAlreadyHave,isPage:this.isPage},success:function(k,h){var f;this.reportAction(d,g,b,c,k);Sfdc.each(h,function(a){this.idsAlreadyHave.push(a.id)},this);k?(f=a.ownerDocument.createElement("div"),f.innerHTML=k.html,f=3==f.childElementCount?f.children[1]:f.firstChild,this.showNewRecElement(f,a)):this.removeRecElement(a)},failure:function(){this.removeRecElement(a)}},this)})},init:function(){var a;
this.isInit=!0;if(a=Sfdc.get(this.id))this.recType=a.getAttribute(d.REC_TYPES),Sfdc.each(Sfdc.select("#"+this.id+" .recElement"),function(a){a&&(a=a.getAttribute(d.REC_ID))&&this.idsAlreadyHave.push(a)},this)},onClick:function(a){var b=Sfdc.Event.getEventTarget(a,".recDismissLink");b?this.rejectRec(this.getRecElement(b)):(b=Sfdc.Event.getEventTarget(a,"*["+d.EXPLAIN_TYPE+"]"))&&this.explainRec(b,this.getRecElement(b).getAttribute(d.REC_ID),b.getAttribute(d.EXPLAIN_TYPE))},onHover:function(a){var b;
if(b=Sfdc.Event.getEventTarget(a,".recElement"))(b=Sfdc.select(".recDismissImage",b)[0])&&("mouseover"===a.type?Sfdc.Dom.addClass(b,"recDismissVisible"):Sfdc.Dom.removeClass(b,"recDismissVisible"))},getRecElement:function(a){return Sfdc.Dom.getParent(a,".recElement")},bindEvents:function(){var a,b;if(!this.isEventsBinded&&(b=Sfdc.get(this.id)))a=chatter.getEventBus(),a.addEventListener("chatter:FollowUnfollow","onAfterFollow",this.onAccepted,this),a.addEventListener("chatter:joinGroup","onAfterJoin",
this.onAccepted,this),Sfdc.on(b,"click",this.onClick,this),Sfdc.on(b,"mouseover",this.onHover,this),Sfdc.on(b,"mouseout",this.onHover,this),this.isEventsBinded=!0},unbindEvents:function(){var a;if(this.isEventsBinded&&(a=Sfdc.get(this.id)))Sfdc.un(a,"click",this.onClick),Sfdc.un(a,"mouseover",this.onHover),Sfdc.un(a,"mouseout",this.onHover),a=chatter.getEventBus(),a.removeEventListener("chatter:FollowUnfollow","onAfterFollow",this.onAccepted,this),a.removeEventListener("chatter:joinGroup","onAfterJoin",
this.onAccepted,this),this.isEventsBinded=!1}};return{create:function(a){Sfdc.get(a.id)&&(g=new SfdcApp.Recommend[a.ctor]({id:a.id}),this.isLoaded=!0)},destroy:function(){g&&(g.unbindEvents(),g=null)},isLoaded:!1,RecommendationGrid:l,DATA_ATTRIBUTES:d}}());
(function(f){function h(a,b,c){f.each(f.select("["+p+"\x3d"+b+"]",a),c)}function k(a,b,c){var d,e=a+l+f.getUID(b);d=g[e];d||(c=c||{},c.element=b,a=m[a],d=new a(c),"function"===typeof d.initialize&&d.initialize(),g[e]=d);return d}function n(a,b){var c=a+l+f.getUID(b),d=g[c];d&&(d.destroy(),delete g[c])}var p="data-topicwidget",l="$$",e=f.ns("SfdcApp.TopicUtils"),g={},m={};e.registerWidgetType=function(a,b){m[a]=b};e.unwireInstance=n;e.wireInstance=k;e.wireDescendents=function(a,b,c){h(a,b,function(a){k(b,
a,c)})};e.unwireDescendents=function(a,b){h(a,b,function(a){n(b,a)})}})(Sfdc);
TopicsAutoCompleteElement=function(a,b,c,d,e,f,h,k,g){AccessibleAutoCompleteInputElement.apply(this,[a,"/chatter/handlers/topics/complete/"+f,b,c,d]);this.displayHeader=!1;this.suggestions=null;this.box=e;this.feedItemId=f;this.textUtil=chatter.getTextUtil();this.assignOnly=h;this.hideTalkingAbout=k;this.hideSuccessMessage=!0===g};TopicsAutoCompleteElement.prototype=new AccessibleAutoCompleteInputElement;
TopicsAutoCompleteElement.prototype.setSuggestions=function(a){(this.suggestions=a)&&0<this.suggestions.length?(this.focused=!0,this.displaySuggestions(!0)):(!this.curSuggestions||0===this.curSuggestions.length)&&this.clearACBox()};TopicsAutoCompleteElement.prototype.displayDefault=function(){this.suggestions&&0<this.suggestions.length?(this.focused=!0,this.displaySuggestions(!0)):this.clearACBox()};
TopicsAutoCompleteElement.prototype.isNav=function(a){return!a||!a.keyCode?!1:a.keyCode==KEY_ARROW_D||a.keyCode==KEY_ARROW_U||a.keyCode==KEY_ARROW_L||a.keyCode==KEY_ARROW_R||a.keyCode==KEY_ESC||a.keyCode==KEY_TAB||a.keyCode==KEY_DELETE||a.keyCode==KEY_BACKSPACE||a.keyCode==KEY_SHIFT||a.keyCode==KEY_ENTER};
TopicsAutoCompleteElement.prototype.isSuggesting=function(a){if(this.curSuggestions)for(var b=0;b<this.curSuggestions.length;b++)if(this.normalizeTopic(this.curSuggestions[b].name)===this.normalizeTopic(a))return!0;return!1};
TopicsAutoCompleteElement.prototype.handleNav=function(a){var b=Sfdc.String.trim(this.element.value);if(KEY_ENTER==a.keyCode&&!this.hasValidSelection())if(this.assignOnly&&!this.isSuggesting(b))Sfdc.Event.preventDefault(a);else{if(this.hasValidText()&&!this.isAdded(b)){if(b.length>SfdcApp.TopicsFeed.TOPIC_MAX_SIZE||b.match(SfdcApp.TopicsFeed.INVALID_CHARS)){Sfdc.Event.preventDefault(a);alert(LC.getLabel("TopicsFeed","badTopicName"));return}if(this.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_TOPICS){Sfdc.Event.preventDefault(a);
alert(LC.getLabel("TopicsFeed","tooManyTopicsNoHints"));return}}SfdcApp.TopicsFeed.done(Sfdc.Dom.getParent(this.box,".topics"),!1,this.hideSuccessMessage)}else if(KEY_ESC!=a.keyCode)if(KEY_COMMA==a.keyCode){var c=this;setTimeout(function(){c.handleComma()},0)}else KEY_TAB==a.keyCode?this.navigateTopics(a):(KEY_ARROW_L==a.keyCode||KEY_ARROW_R==a.keyCode)&&this.getSelected()||0===this.textUtil.getCaretLocation(this.element)&&KEY_ARROW_L==a.keyCode?this.navigateTopics(a):this.getSelected()&&(KEY_DELETE==
a.keyCode||KEY_BACKSPACE==a.keyCode)?(b=this.getSelected(),SfdcApp.TopicsFeed.deleteTopic(b,this.feedItemId),this.navigateTopics(a)):((KEY_ARROW_U==a.keyCode||KEY_ARROW_D==a.keyCode)&&this.clearSelected(),AutoCompleteInputElement.prototype.handleNav.call(this,a))};TopicsAutoCompleteElement.prototype.handleComma=function(){if(this.element.value.match(",$")&&(this.element.value=this.element.value.replace(/,+$/,""),(!this.assignOnly||this.isSuggesting(name))&&this.complete()))this.element.value=""};
TopicsAutoCompleteElement.prototype.navigateTopics=function(a){var b=Sfdc.Dom.getPrevious(this.element,".topicList"),c=Sfdc.get(".topic.selected",b),d,e=null===c?null:c,f=a.keyCode==KEY_ARROW_R||a.keyCode==KEY_DELETE||KEY_BACKSPACE==a.keyCode||a.keyCode==KEY_TAB&&!a.shiftKey;if(e)d=f?Sfdc.Dom.getNext(e,".topic"):Sfdc.Dom.getPrevious(e,".topic");else if(this.hasValidSelection()){this.select(-1);if(f)return;Sfdc.Event.preventDefault(a)}else if(null===e)if(a.keyCode==KEY_TAB&&this.curSuggestions&&this.curSuggestions.length&&
0<this.curSuggestions.length)this.select(0);else if(f){if(a.keyCode==KEY_TAB&&(!this.curSuggestions||!this.curSuggestions.length||0===this.curSuggestions.length))return}else b=Sfdc.select(".topic",b),d=b[b.length-1];((a.keyCode==KEY_ARROW_R||a.keyCode==KEY_TAB)&&null===d||d&&c&&d!=this.selectedTopic)&&this.clearSelected();a.keyCode==KEY_TAB&&a.shiftKey&&null===d||(d&&d!=c&&(Sfdc.Dom.addClass(d,"selected"),this.select(-1)),Sfdc.Event.preventDefault(a))};
TopicsAutoCompleteElement.prototype.getSelected=function(){return Sfdc.get(".topic.selected",this.box)};TopicsAutoCompleteElement.prototype.clearSelected=function(){var a=this.getSelected();a&&Sfdc.Dom.removeClass(a,"selected")};
TopicsAutoCompleteElement.prototype.handleInput=function(a){if(-1<this.element.value.indexOf(",")){a=this.element.value.split(",");for(var b=a.length,c=0;c<b-1;c++)Sfdc.String.trim(a[c])&&this.validateAndAddTopic(a[c]);this.element.value=a[b-1];Sfdc.Dom.set(this.element,"length",2)}else this.isNav(a)||this.clearSelected(),this.isNav(a)&&!this.inKeyIME&&(this.element.value=this.element.value.replace("\n","")),AutoCompleteInputElement.prototype.handleInput.call(this,a)};
TopicsAutoCompleteElement.prototype.innerGetSuggestions=function(a){var b,c=[];this.element&&a.length>=this.minSuggestLen&&!Sfdc.Dom.hasClass(this.element,"ghost")&&(b=this.checkCacheOrRetrieve(a))&&(b=this.getValidSuggestions(a,b));b&&0<b.length&&c.push({title:null,suggestions:b});this.suggestions&&0<this.suggestions.length&&c.push({title:null,suggestions:this.suggestions});return 0===c.length?null:c};
TopicsAutoCompleteElement.prototype.getValidSuggestions=function(a,b){var c=AutoCompleteInputElement.prototype.getValidSuggestions.call(this,a,b);return 5<c.length?c.splice(0,5):c};TopicsAutoCompleteElement.prototype.isValidSuggestion=function(a,b){var c;c=this.getRegexForInput(a);if(!b.name.match(c)||this.isAdded(b.name))return!1;if(this.suggestions)for(c=0;c<this.suggestions.length;c++)if(this.sameTopic(b.name,this.suggestions[c].name))return!1;return!0};
TopicsAutoCompleteElement.prototype.positionACBox=function(a){if(this.element&&this.acBox&&(!a||this.isACBoxVisible()))a=this.getACWidth(),this.acBox.setStyle("width",a+"px")};TopicsAutoCompleteElement.prototype.addMarkupBeforeGroup=function(a,b){0<b&&a.push('\x3cdiv class\x3d"line"\x3e\x26nbsp;\x3c/div\x3e')};TopicsAutoCompleteElement.prototype.getACWidth=function(){return this.box.clientWidth};TopicsAutoCompleteElement.prototype.getMinimumWidth=function(){return this.box.clientWidth};
TopicsAutoCompleteElement.prototype.handleEmptyInput=function(){this.curSuggestions=this.getSuggestions("");this.updateACBox(this.curSuggestions)};
TopicsAutoCompleteElement.prototype.complete=function(){if(!this.element)return!1;if(this.hasValidSelection()){var a=this.curSuggestions[this.selected],b=this.getRegexForInput(this.element.value);this.addTopic(a.name,a.id,a.suggestionType,a.suggestionScore,a.suggestionRank,a.position,a.postLength);AutoCompleteInputElement.normalize(a.name).match(b)&&(this.element.value="",Sfdc.Dom.set(this.element,"length",2));SfdcApp.TopicsFeed.clearGhost(this.element)}else{if(this.hasValidText()&&(a=Sfdc.String.trim(this.element.value),
!this.validateAndAddTopic(a)))return!1;this.element.value="";Sfdc.Dom.set(this.element,"length",2)}this.displayDefault(!0);this.select(-1);this.element.focus();return!0};TopicsAutoCompleteElement.prototype.validateAndAddTopic=function(a){var b=!0;SfdcApp.TopicsFeed.isValidTopicName(a)?this.isAdded(a)?alert(LC.getLabel("TopicsFeed","alreadyAssigned")+": "+a):this.addTopic(a):(alert(LC.getLabel("TopicsFeed","badTopicName")+": "+a),b=!1);return b};
TopicsAutoCompleteElement.prototype.hasValidText=function(){return Sfdc.Dom.hasClass(this.element,"ghost")?!1:0<Sfdc.String.trim(this.element.value).length};TopicsAutoCompleteElement.prototype.getSelectedSuggestion=function(){return this.hasValidSelection()?this.curSuggestions[this.selected]:null};TopicsAutoCompleteElement.prototype.sameTopic=function(a,b){return this.normalizeTopic(a)===this.normalizeTopic(b)};
TopicsAutoCompleteElement.prototype.normalizeTopic=function(a){return a.replace(/\s/g,"").toLowerCase()};TopicsAutoCompleteElement.prototype.isAdded=function(a){var b,c=Sfdc.select(".topic",this.box);for(b=0;b<c.length;b++)if(this.sameTopic(a,c[b].getAttribute("data-topicname")))return!0;return!1};TopicsAutoCompleteElement.prototype.getTopicsCount=function(){var a=Sfdc.select(".topic",this.box);return a&&a.length?a.length:0};
TopicsAutoCompleteElement.prototype.addTopic=function(a,b,c,d,e,f,h){var k=Sfdc.get(".topicList",this.box),g=document.createElement("li");k.appendChild(g);Sfdc.Dom.addClass(g,"topic");g.innerHTML='\x3cdiv class\x3d"name"\x3e'+Sfdc.String.escapeToHtml(a,!1)+'\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e';g.setAttribute("data-topicname",a);this.removeFromSuggestions(this.suggestions,a);this.removeFromSuggestions(this.curSuggestions,
a);SfdcApp.TopicsFeed.setupTopicElem(g);SfdcApp.TopicsFeed.save(this.feedItemId,a,b,g,c,d,e,f,h)};TopicsAutoCompleteElement.prototype.removeFromSuggestions=function(a,b){if(a)for(i=0;i<a.length;i++)if(this.sameTopic(b,a[i].name)){a.splice(i,1);break}};TopicsAutoCompleteElement.prototype.hook_registerEventHandlers=function(){var a=this;Sfdc.on(this.element,"focus",function(){a.focused=!0});Sfdc.on(this.element,"keyup",function(b){a.handleInput(b)});Sfdc.on(this.element,"keydown",function(b){a.handleNav(b)})};
TopicsAutoCompleteElement.prototype.addACBoxToPage=function(a){var b=document.createElement("div");Sfdc.Dom.addClass(b,"topicsAc");b.appendChild(a);this.box.parentNode.appendChild(b);if(Sfdc.userAgent.isIE7&&(a=Sfdc.Dom.getParent(this.box,".feeditembodyandfooter")))a.style.zIndex=100};
TopicsAutoCompleteElement.prototype.retrieveFromServlet=function(a){if(!a||a.length<this.minSuggestLen)return!1;255<a.length&&(a=a.substring(0,255));if(this.triedQueries[this.getCacheKey(a)])return!1;this.triedQueries[this.getCacheKey(a)]=!0;var b=this;chatter.getToolbox().post({url:"/topics/complete/"+this.feedItemId,params:{topicPrefix:a},success:function(c,d){d.suggestions&&(b.saveToCache(a,d.suggestions),b.displaySuggestions(!0),0===d.suggestions.length&&b.hook_onEmptyServletResult(a))}});return!0};
TopicsAutoCompleteElement.prototype.getCacheKey=function(a){return a};TopicsAutoCompleteElement.prototype.disableAC=function(){if(this.enabled){this.enabled=!1;this.clearSuggestions();if(Sfdc.userAgent.isIE7){var a=Sfdc.Dom.getParent(this.box,".feeditembodyandfooter");a&&(a.style.zIndex=0)}AutoCompleteInputElement.prototype.clearACBox.call(this)}};TopicsAutoCompleteElement.prototype.clearACBox=function(){this.scrolling=!1;this.groupedSuggestions=null;this.deselect();this.displayACBox()};
TopicsAutoCompleteElement.prototype.addFooter=function(a,b){0===b&&(null===this.suggestions?a.push('\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"loadingsuggestions"/\x3e \x3cimg src\x3d"/s.gif"/\x3e \x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e'):a.push('\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"nosuggestions"/\x3e '+LC.getLabel("TopicsFeed","noMoreSuggestions")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"))};
TopicsAutoCompleteElement.prototype.getSuggestionHtml=function(a){var b=[];b.push("\x3cspan class\x3d'actitle'\x3e");var c=escapeHTML(this.findInput(this.lastInput)),d=escapeHTML(a.name);c&&0<Sfdc.String.trim(c).length&&(c=this.getRegexForInput(c),d=d.replace(c,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e'));b.push(d);b.push("\x3c/span\x3e");!this.hideTalkingAbout&&a.talkingAbout&&(b.push("\x3cspan class\x3d'aclabel'\x3e"),b.push(a.talkingAbout),b.push("\x3c/span\x3e"));return b.join("")};
(function(){Sfdc.provide("SfdcApp.Recommend.JitRecommendationGrid",function(){function b(a){SfdcApp.Recommend.RecommendationGrid.call(this,a)}b.prototype=new SfdcApp.Recommend.RecommendationGrid;b.prototype.replaceRec=function(a,b,d){var c;if(a&&(a=this.extractRecElement(a,b,d)))this.reportAction(a.getAttribute(SfdcApp.Recommend.DATA_ATTRIBUTES.PURPOSE),a.getAttribute(SfdcApp.Recommend.DATA_ATTRIBUTES.PROC_NAME),b,d),this.unbindEvents(),c=Sfdc.Dom.getParent(Sfdc.get(this.id),".jitRecs"),Sfdc.Effects.fadeOut(c,
function(){Sfdc.Dom.removeChild(c)})};return b}())})();
(function(){Sfdc.provide("SfdcApp.Recommend.JitRecsPanel",{subjectId:null,wire:function(b){this.subjectId=b;chatter.getEventBus().addEventListener("chatter:FollowUnfollow","onAfterFollow",function(e,c){var a,d;if(c.jitRecs&&c.entityId===b){if(d=Sfdc.get("jitRecsPlaceholder"))a=document.createElement("div"),a.innerHTML=Sfdc.String.trim(c.jitRecs),a=Sfdc.Dom.getFirstChild(a,".jitRecs"),Sfdc.Dom.hideByVisibility(a),d.parentNode.insertBefore(a,d),Sfdc.Dom.removeChild(d),Sfdc.Effects.fadeIn(a);Sfdc.Resource.addInlineJavaScript(c.jitRecsInit)}})},
hasJitRecs:function(b){return this.subjectId===b}})})();
SfdcApp.TopicUtils.registerWidgetType("TopicInfoBubble",function(a){function d(b){b=b.element;if(this.button=a.get("."+c.CSS_INFO_BUBBLE_BUTTON,b))this.bubble=a.get("."+c.CSS_INFO_BUBBLE,b),a.on(this.button,"click",this.buttonOnClick,this)}var c={CSS_HIDDEN:"hidden",CSS_INFO_BUBBLE:"topic-infoBubble",CSS_INFO_BUBBLE_BUTTON:"iconParent"};d.prototype={buttonOnClick:function(b){a.Dom.hasClass(this.bubble,c.CSS_HIDDEN)?(a.Dom.removeClass(this.bubble,c.CSS_HIDDEN),a.on(document,"click",this.documentOnClick,
this),a.on(this.bubble,"keydown",this.onKeyDown,this),a.on(this.bubble,a.userAgent.isIE?"focusout":"blur",this.hide,this,!a.userAgent.isIE),a.Event.stopPropagation(b)):this.hide()},destroy:function(){this.button&&this.bubble&&(a.un(this.button,"click",this.buttonOnClick),this.removeInfoBubbleEvents())},documentOnClick:function(b){a.Event.getEventTarget(b,"."+c.CSS_INFO_BUBBLE)||this.hide()},hide:function(){a.Dom.addClass(this.bubble,c.CSS_HIDDEN);this.removeInfoBubbleEvents()},onKeyDown:function(a){27===
a.keyCode&&this.hide()},removeInfoBubbleEvents:function(){a.un(document,"click",this.documentOnClick);a.un(this.bubble,"keydown",this.onKeyDown);a.un(this.bubble,a.userAgent.isIE?"focusout":"blur",this.hide)}};return d}(Sfdc));
(function(){Sfdc.provide("SfdcApp.TopicsFeed",{TOPIC_MAX_SIZE:99,MAX_TOPICS:100,MAX_FEED_ITEM_TOPICS:10,LINK_USED_CLASS:"clicked",TOPIC_COMPONENT_SELECTOR:".topics",TOPIC_SELECTOR:".topic",FEED_ITEM_SELECTOR:".feeditem",KNOWLEDGE_ARTICLE_SELECTOR:".knowledgeTopic",TOPICS_ON_RECORD_PAGE_SELECTOR:".topicsOnRecordPage",EXTRA_SELECTOR:".extra",MORE_SELECTOR:".more",MORE_LINK_SELECTOR:".moreLink",EDIT_SELECTOR:".editLink",TOPIC_NAME_SELECTOR:"tailBreadcrumbNode",ASSIGNED_IN_EDITOR:"Editor",ASSIGNED_IN_HASHTAG:"HashTag",
INVALID_CHARS:"[\\]]",DONE_MESSAGE_DISPLAY:3E3,trimTopic:function(a){a=Sfdc.String.trim(a);return 255<a.length?a.substring(0,255):a},setupTopicElem:function(a){if(Sfdc.userAgent.isIE7){var b=Sfdc.Dom.getParent(a,".topicInput");b&&a.clientWidth>=0.9*b.clientWidth&&Sfdc.Dom.addClass(a,"wrap")}},inFeed:function(a){return null!==Sfdc.Dom.getParent(a,".feedcontainer")},isValidTopicName:function(a){return a.length<=SfdcApp.TopicsFeed.TOPIC_MAX_SIZE&&!a.match(SfdcApp.TopicsFeed.INVALID_CHARS)},isValidInput:function(a,
b,c){if(b&&0<Sfdc.String.trim(b.value).length&&!Sfdc.Dom.hasClass(b,"ghost")){b=this.trimTopic(b.value);if(a.isAdded(b))return alert(LC.getLabel("TopicsFeed","alreadyAssigned")),!1;if("0D5"==c.substring(0,3)&&a.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_FEED_ITEM_TOPICS||a.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_TOPICS)return alert(LC.getLabel("TopicsFeed","toManyTopics")),!1;if(!this.isValidTopicName(b))return alert(LC.getLabel("TopicsFeed","badTopicName")+": "+b),!1}return!0},isLinkUsed:function(a){if(null===
a)return!1;if(Sfdc.Dom.hasClass(a,this.LINK_USED_CLASS))return!0;Sfdc.Dom.addClass(a,this.LINK_USED_CLASS);return!1},more:function(a){var b=Sfdc.get(SfdcApp.TopicsFeed.MORE_SELECTOR,a);a=Sfdc.get(SfdcApp.TopicsFeed.EXTRA_SELECTOR,a);Sfdc.Dom.removeClass(a,"extra");Sfdc.Dom.removeChild(b)},moreOrLess:function(a){var b=Sfdc.get(SfdcApp.TopicsFeed.EXTRA_SELECTOR,a);a=Sfdc.get(SfdcApp.TopicsFeed.MORE_LINK_SELECTOR,a);Sfdc.Dom.isVisible(b)?(Sfdc.Dom.hideByDisplay(b),Sfdc.Dom.updateHTML(a,LC.getLabel("TopicsFeed",
"showMore"))):(Sfdc.Dom.show(b,!0),Sfdc.Dom.updateHTML(a,LC.getLabel("TopicsFeed","showLess")))},editFromMenu:function(a){a=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,Sfdc.get(a));SfdcApp.TopicsFeed.edit(a)},edit:function(a,b,c,d,e,k){var g=this,f=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,a);d={suggestionType:d,suggestionScore:e,suggestionRank:k,assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR,widgetStyle:a.getAttribute("data-widgetStyle")};this.isLinkUsed(f)||(c?d.topicId=c:b&&(d.topicName=
this.trimTopic(b)),b=a.getAttribute("data-entityId"),chatter.getToolbox().post({url:"/topics/edit/"+b,params:d,success:function(b,c){c.html&&g.showEdit(a,c.html)}}))},done:function(a,b,c){var d=a.getAttribute("data-entityId"),e=SfdcApp.TopicsFeed.getAcInstance(d),k=this,g={assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR},f=Sfdc.get(".input",a);if(f&&!Sfdc.Dom.hasClass(f,"ghost")){var h=this.trimTopic(f.value);if(h&&(!Sfdc.Dom.hasClass(a,"nocreate")||e.isSuggesting(h))&&!b)if(SfdcApp.TopicsFeed.isValidInput(e,
f,d))g.topicName=h;else{f.focus();return}}c&&(g.noSuccess=!0);g.isWidget=a.getAttribute("data-isWidget");g.referrer=a.getAttribute("data-referrer");g.widgetStyle=a.getAttribute("data-widgetStyle");if(b=a.getAttribute("data-customUrl"))g.customUrl=b;Sfdc.Dom.removeChild(Sfdc.get(".topicsEditor",a));e&&e.disableAC();this.isLinkUsed(Sfdc.get(".topicEditDone",a))||(chatter.getToolbox().post({url:"/topics/refresh/"+d,params:g,success:function(b,c){SfdcApp.TopicUtils.unwireDescendents(a,"TopicInfoBubble");
var d=Sfdc.Dom.getParent(a);Sfdc.Dom.removeChild(a);c.html&&(Sfdc.Dom.insertHTML(d,c.html),d=Sfdc.get(".topics",d),k.setupHandlers(d),k.fadeOutSuccess(d),Sfdc.userAgent.isIE7&&(d.style.width=Sfdc.Dom.getWidth(d)))}}),Sfdc.un(document.body,"click",SfdcApp.TopicsFeed.handleGlobalEvents),Sfdc.un(document.body,"focus",SfdcApp.TopicsFeed.handleGlobalEvents,!0),Sfdc.un(document.body,"focusin",SfdcApp.TopicsFeed.handleGlobalEvents))},fadeOutSuccess:function(a){var b=Sfdc.get(".success",a);if(b){Sfdc.Aria.notify(Sfdc.Dom.getText(b));
var c=Sfdc.get(".view",a);Sfdc.Dom.hideByDisplay(c);setTimeout(function(){Sfdc.Effects.fadeOut(b,function(){Sfdc.Dom.removeChild(b);Sfdc.Effects.fadeIn(c)})},SfdcApp.TopicsFeed.DONE_MESSAGE_DISPLAY)}},setupHandlers:function(a){var b;if(b=Sfdc.isString(a)?Sfdc.get(a):a){a=b.getAttribute("data-entityId");var c=Sfdc.get(SfdcApp.TopicsFeed.MORE_LINK_SELECTOR,b),d=b.getAttribute("data-widgetStyle");if(c){if(d&&"ENHANCED"===d.toUpperCase())Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.moreOrLess(b)});
else Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.more(b)});SfdcApp.TopicsFeed.applyHoverHandler(c)}for(var c=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_SELECTOR,b),e=0;e<c.length;e++)SfdcApp.TopicsFeed.applyHoverHandler(c[e]),d&&"ENHANCED"===d.toUpperCase()&&SfdcApp.TopicsFeed.applyTopicHandlers(c[e],a);if(a=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,b))Sfdc.on(a,"click",function(){SfdcApp.TopicsFeed.edit(b)});SfdcApp.TopicUtils.wireDescendents(b,"TopicInfoBubble");Sfdc.Dom.addClass(b,"init")}},addHoverClass:function(a){Sfdc.Dom.addClass(this,
"hover")},removeHoverClass:function(a){Sfdc.Dom.removeClass(this,"hover")},applyTopicHandlers:function(a,b){var c=Sfdc.get(".delete",a).parentNode;Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.deleteTopic(a,b)});Sfdc.on(a,"mouseover",function(){Sfdc.Dom.addClass(a,"topicHover")});Sfdc.on(a,"mouseout",function(){Sfdc.Dom.removeClass(a,"topicHover")});SfdcApp.TopicsFeed.setupTopicElem(a)},deleteTopic:function(a,b){var c=a.getAttribute("data-topicid"),d=Sfdc.get(".input",Sfdc.Dom.getParent(a,SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR));
d&&d.focus();chatter.getToolbox().post({url:"/topics/delete/"+b+"/"+c,success:function(b,c){Sfdc.Dom.removeChild(a)}})},closeAllHighlightSessions:function(){var a,b=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR);for(a=0;a<b.length;a++)Sfdc.get(".view.highlight",b[a])&&SfdcApp.TopicsFeed.done(b[a])},showEdit:function(a,b){var c=a.getAttribute("data-entityId"),d="RECORD_PAGE"===a.getAttribute("data-referrer"),e=a.getAttribute("data-widgetStyle")&&"ENHANCED"===a.getAttribute("data-widgetStyle").toUpperCase(),
k=SfdcApp.TopicsFeed.isHideSuccessMessage(a);b=Sfdc.Dom.insertHTML(a,b);if(e){Sfdc.Dom.hideByDisplay(Sfdc.get(".view",a));var g=Sfdc.get(".moreLink",a);g&&Sfdc.Dom.hideByDisplay(g)}else Sfdc.Dom.removeChild(Sfdc.get(".view",a));(g=Sfdc.get(".success",a))&&Sfdc.Dom.removeChild(g);var f=Sfdc.get(".input",a),g=Sfdc.get(".topicInput",a),h=Sfdc.get(".topicEditDone",a),m=Sfdc.get(".topicsEditor",a),m=Sfdc.Dom.getWidth(m),h=Sfdc.Dom.getWidth(h),h=m-h-36;e?d=new StandaloneTopicsAutoCompleteElement(f.id,2,
null,!1,g,c,Sfdc.Dom.hasClass(a,"nocreate"),d,a):(Sfdc.Dom.setStyle(g,"width",h+"px"),d=new TopicsAutoCompleteElement(f.id,2,null,!1,g,c,Sfdc.Dom.hasClass(a,"nocreate"),d,k));d.displayDefault();if(Sfdc.userAgent.isFirefox&&!e){var l=function(){f.style.width="1000px";Sfdc.un(f,"keydown",l)};Sfdc.on(f,"keydown",l)}else Sfdc.on(f,"keyup",function(){SfdcApp.TopicsFeed.adjustInputWidth(f)}),Sfdc.on(f,"keydown",function(){SfdcApp.TopicsFeed.adjustInputWidth(f)});Sfdc.Dom.hasClass(f,"ghost")&&(Sfdc.on(f,
"keydown",function(){SfdcApp.TopicsFeed.clearGhost(f)}),Sfdc.on(f,"mousedown",function(){var a=Sfdc.Dom.getWidth(f);SfdcApp.TopicsFeed.clearGhost(f);f.style.width=a+"px"}));Sfdc.on(Sfdc.get(".topicEditDone",a),"click",function(){SfdcApp.TopicsFeed.done(a,!1,k)});Sfdc.on(g,"click",function(a){a=Sfdc.Event.getEventTarget(a);!Sfdc.Dom.hasClass(a,"topic")&&!Sfdc.Dom.getParent(a,SfdcApp.TopicsFeed.TOPIC_SELECTOR)&&f.focus()});if(!e){e=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_SELECTOR,a);for(d=0;d<e.length;d++)this.applyTopicHandlers(e[d],
c)}Sfdc.userAgent.isChrome?(e=f.value,f.value="",f.focus(),f.value=e):f.focus();Sfdc.on(document.body,"click",SfdcApp.TopicsFeed.handleGlobalEvents);Sfdc.on(document.body,"focus",SfdcApp.TopicsFeed.handleGlobalEvents,this,!0);Sfdc.on(document.body,"focusin",SfdcApp.TopicsFeed.handleGlobalEvents);var n=this;chatter.getToolbox().post({url:"/topics/suggest/"+c,params:{editMode:!0},success:function(a,b){b.suggestions&&n.getAcInstance(c).setSuggestions(b.suggestions)}})},adjustInputWidth:function(a){var b=
Sfdc.Dom.computeTextWidth(a.value+".",a)+15;Sfdc.Dom.setStyles(a,{width:b+"px"})},clearGhost:function(a){Sfdc.Dom.hasClass(a,"ghost")&&(Sfdc.Dom.removeClass(a,"ghost"),a.value="")},save:function(a,b,c,d,e,k,g,f,h){chatter.getToolbox().post({url:"/topics/assignTo/"+a,params:{topicId:c,isWidget:!SfdcApp.TopicsFeed.inFeed(d),topicName:SfdcApp.TopicsFeed.trimTopic(b),suggestionType:e,suggestionScore:k,suggestionRank:g,topicPosition:f,postLength:h,assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR},success:function(b,
c){c.topicId?(d.setAttribute("data-topicid",c.topicId),SfdcApp.TopicsFeed.applyTopicHandlers(d,a)):(Sfdc.Dom.removeChild(d),alert(LC.getLabel("TopicsFeed","badTopicName")))},failure:function(a,b){Sfdc.Dom.removeChild(d)}})},getAcInstance:function(a){return AutoCompleteInputElement.instanceRefs["input"+a]},applyHandlersNew:function(){SfdcApp.TopicsFeed.applyHandlers(!1)},applyHandlersAll:function(){SfdcApp.TopicsFeed.applyHandlers(!0)},applyHandlers:function(a){var b,c=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR);
for(b=0;b<c.length;b++){var d=c[b];(a||!Sfdc.Dom.hasClass(d,"init"))&&SfdcApp.TopicsFeed.setupHandlers(d)}},beforeNewFeedPost:function(){SfdcApp.TopicsFeed.closeAllHighlightSessions()},afterNewFeedPost:function(a,b){var c=b.json.feedItemId;if(c){var d=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,Sfdc.get(c));if(d&&(SfdcApp.TopicsFeed.setupHandlers(d),!Sfdc.get(".topicPage"))){var e=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,d);e&&e.focus();chatter.getToolbox().post({url:"/topics/suggest/"+
c,success:function(a,b){var c,e=Sfdc.get(".suggestions",d);if(0===b.suggestions.length)e.innerHTML=LC.getLabel("TopicsFeed","noSuggestions");else{e.innerHTML="";for(c=0;c<b.suggestions.length;c++){var m=b.suggestions[c];0!==c&&e.appendChild(document.createTextNode(", "));var l=document.createElement("a");l.innerHTML=Sfdc.String.escapeToHtml(m.name);l.setAttribute("href","#");e.appendChild(l);Sfdc.Dom.addClass(l,"discreteLink");SfdcApp.TopicsFeed.applyHoverHandler(l);SfdcApp.TopicsFeed.applyAddHandler(d,
l,m)}}}})}}},afterComment:function(a,b){var c=Sfdc.Dom.getParent(b.element,SfdcApp.TopicsFeed.FEED_ITEM_SELECTOR);(c=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,c))&&SfdcApp.TopicsFeed.done(c,!0,!0)},applyAddHandler:function(a,b,c){Sfdc.on(b,"click",function(){SfdcApp.TopicsFeed.edit(a,c.name,c.id,c.suggestionType,c.suggestionScore,c.suggestionRank)})},applyHoverHandler:function(a){Sfdc.on(a,"mouseover",SfdcApp.TopicsFeed.addHoverClass,a);Sfdc.on(a,"mouseout",SfdcApp.TopicsFeed.removeHoverClass,
a)},handleGlobalEvents:function(a){var b=Sfdc.get(".topicsEditor"),c=Sfdc.Dom.getParent(b),d=c.getAttribute("data-widgetStyle"),e=c.getAttribute("data-referrer"),e=e&&"VISUAL_FORCE_WIDGET"===e.toUpperCase(),d=d&&"ENHANCED"===d.toUpperCase()&&!e;b&&(e=Sfdc.Event.getEventTarget(a),(!(d&&"focus"===a.type)||!Sfdc.Dom.hasClass(e,"rightContent")&&!Sfdc.Dom.hasClass(e,"leftContent"))&&null===Sfdc.Dom.getParent(e,".topicsEditor")&&(e!=b&&null===Sfdc.Dom.getParent(e,".autoCompleteGroup")&&!Sfdc.Dom.hasClass(e,
"autoCompleteSelectedRow")&&!Sfdc.Dom.hasClass(e,"autoCompleteRow")&&!Sfdc.Dom.hasClass(e,"autoCompleteRowLink")&&!Sfdc.Dom.hasClass(e,"autocompleteMatch")&&!Sfdc.Dom.hasClass(e,"actitle")&&!Sfdc.Dom.hasClass(e,"aclabel"))&&SfdcApp.TopicsFeed.done(Sfdc.Dom.getParent(b,SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR),!0,SfdcApp.TopicsFeed.isHideSuccessMessage(c)))},isHideSuccessMessage:function(a){a=a.getAttribute("data-topicHideSuccess");return null!==a&&"true"===a}});chatter.getEventBus().addEventListener("chatter:feed",
"onBeforeNewPostFeedUpdate",SfdcApp.TopicsFeed.beforeNewFeedPost);chatter.getEventBus().addEventListener("chatter:feed","onAfterNewPostFeedUpdate",SfdcApp.TopicsFeed.afterNewFeedPost);chatter.getEventBus().addEventListener("chatter:publisher","onAfterComment",SfdcApp.TopicsFeed.afterComment);chatter.getEventBus().addEventListener("chatter:feed","onAfterShowMoreFeedItems",SfdcApp.TopicsFeed.applyHandlersNew);chatter.getEventBus().addEventListener("chatter:feed","onAfterFeedRefresh",SfdcApp.TopicsFeed.applyHandlersAll);
chatter.getEventBus().addEventListener("unifiedSearchPage:feedSearchResults","onAfterResultsShown",SfdcApp.TopicsFeed.applyHandlersAll)})();
StandaloneTopicsAutoCompleteElement=function(b,c,d,e,f,g,h,a,k){TopicsAutoCompleteElement.apply(this,[b,c,d,e,f,g,h,a]);this.topicContainer=k};StandaloneTopicsAutoCompleteElement.prototype=new TopicsAutoCompleteElement;
StandaloneTopicsAutoCompleteElement.prototype.addTopic=function(b,c,d,e,f,g,h){var a=document.createElement("div");a.innerHTML='\x3ca class\x3d"discreteLink"\x3e'+Sfdc.String.escapeToHtml(b,!1)+'\x3c/a\x3e\x3cspan class\x3d"name"\x3e\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e\x3c/span\x3e';a.setAttribute("class","topic standaloneTopicWidget");a.setAttribute("data-topicname",b);Sfdc.get(".placeholder",this.topicContainer).appendChild(a);
var k=Sfdc.get(".topicList",this.box),a=document.createElement("li");k.appendChild(a);Sfdc.Dom.addClass(a,"topic");a.innerHTML='\x3cdiv class\x3d"name"\x3e'+Sfdc.String.escapeToHtml(b,!1)+'\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e';a.setAttribute("data-topicname",b);this.removeFromSuggestions(this.suggestions,b);this.removeFromSuggestions(this.curSuggestions,b);SfdcApp.TopicsFeed.setupTopicElem(a);SfdcApp.TopicsFeed.save(this.feedItemId,
b,c,a,d,e,f,g,h)};StandaloneTopicsAutoCompleteElement.prototype.isAdded=function(b){var c,d=Sfdc.select(".topic.standaloneTopicWidget",this.container);for(c=0;c<d.length;c++)if(this.sameTopic(b,d[c].getAttribute("data-topicname")))return!0;return!1};
Sfdc.Event.fireEvent(chatter,"chatter:onDeferLoad");chatter.onDeferLoad=function(a){a()};Sfdc.provide("SfdcApp.ChatterDeferLoaded",{});

//# sourceMappingURL=/javascript/1417772649000/sfdc/source/ChatterDefer.js.map
