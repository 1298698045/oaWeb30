<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link rel="stylesheet" href="/css/themes/lightning/alerts.css" />
    <link rel="stylesheet" href="/css/themes/lightning/iconfont.css" />
    <link href="/element/element.css" rel="stylesheet" />
    <style>
        * {
            margin:0;
            padding:0;
        }
        .el-input {
            float:left;
            width:100%;
            margin-top:5px;
        }  
        .shift-name-title {
            float:left;
            margin-top:5px;
        }
        .modal-body {
            font-size:12px;
            color:#606266;
        }
        #photo .uiModal--medium .modal-container {
            width: 70%;
        }
        .title-text {
             color: rgb(196, 196, 196)
        }
        .number-title {
            margin-left:60px;
        }
        .ant-radio-group-time {
            float:left;
            margin-left:15px;
            margin-right:40px;
        }
        .ant-radio-group-set-number{
            float:left;
            margin-top:5px;
            
        }
        .ant-radio-group-set {
            margin-top:10px;
        }
        .ant-radio-group-time>span {
            float:left;
            margin-top:5px;
        }
        .ant-radio-group-time .el-input {
            margin-left:5px;
            width:100px;
        }
        .el-time-panel {
            z-index:10000 !important;
        }
        .ant-radio-group-set {
            height:30px;
        }
        .rest {
            float:left;
            margin-top:5px;
        }
        .el-input--prefix .el-input__inner {
            padding-left: 22px;
            padding-right: 20px;
        }
        .el-input__prefix {
            left:0px;
        }
        .el-input__suffix {
            right:0px;
        }
        .el-input-number {
            top:10px;
        }
        .el-input-number:hover .el-input-number__decrease {
            display:block;
        }
        .el-input-number:hover .el-input-number__increase {
            display:block;
        }
        .el-input-number__decrease {
            height:13px;
            line-height:13px;
            width:20px;
            bottom:1px;
            top:auto;
            left:auto;
            right:1px;
            border:0;
            border-left:1px solid #C0C4CC;
            border-top:1px solid #C0C4CC;
            border-radius:0;
            display:none;
        }
        .el-input-number__increase {
            height:12px;
            line-height:12px;
            width:20px;
            top:1px;
            left:auto;
            right:1px;
            border:0;
            border-left:1px solid #C0C4CC;
            border-radius:0;
            display:none;

        }
        .el-input-number .el-input {
            width:50px;
            margin-left:0;
        }
        .el-input-number .el-input input{
            width:50px;
            padding:0;
            text-align:left;
            text-indent:5px;

        }
        .el-input-number {
            width:50px;
        }
        .class-manage-section-interval .title-text {
            margin-top:13px;
        }
        .class-manage-section-interval {
            margin-top:10px;
        }
        .late {
            margin-top:10px;
            float:left;
            width:50%;
            height:30px;
            margin-top:10px;
        }
        .late .el-input-number{
            margin-left:10px;
        }
        .late .el-input-number,.late .el-input input{
            width:70px;
        }
        .timesizechecked {
            margin-top:10px;
        }
        .timesizechecked-tr {
            height:40px;
            line-height:40px;
        }
        .table-coloer {
            background-color:#f6f6f6;
            padding-left:30px;
        }
        .timesizechecked-tr .ant-radio-group-time .el-input {
            margin-top:6px;
        }
        .timesizechecked-tr .ant-radio-group-set-number {
            margin:0;
        }
        .timesizechecked-tr .ant-radio-group-time > span {
            margin:0;
            
        }
        .timesizechecked-tr .ant-radio-group-time > span {
            float:left;
        }
        .size-time {
            float:left;
            margin-left:60px;
            height:40px;
        }
        .size-time .ant-radio-group-time {
            margin:0;
        }
        .size-time .el-input {
            margin-left:0;
        }
        .size-time .ant-radio-group-time > span {
            margin-left:5px;
            margin-right:5px;
        }
        .shift-head .el-input {
            margin-right:10px;
        }
       .shift-head .el-select,.shift-head .el-input{
            float:right;
        }
       .shift-body-foot .el-select,.shift-body-foot .el-input{
            float:right;
        }
       .shift-body-foot .el-input {
            margin-right:15px;
        }
        .shift-item {
            width:235px;
            margin-top:10px;
        }
        .shift-body-main {
            width:100%;
            padding:0rem 3rem;
            box-sizing:border-box;
        }
        .modal-body {
            padding:0;
            padding-bottom:20px;
        }
        .shift-body-titme {
            height:30px;
            background-color: rgb(243, 242, 242);
            line-height:30px;
            border-radius:4px;
            padding-left:15px;
            margin:2rem 2rem 0.5rem 2rem;
        }
        .late4 + div {
            float:left;
            width:100%;
        }
        .clear {
            clear:both;
        }
        .shift-item .el-checkbox{
            margin-top:5px;
        }
        .shift-item-cheekbox {
            float:left;
            margin-top:20px;
        }
        .shift-item-cheekbox .el-checkbox{
            margin-right:5px;
        }
        .el-popper {
            z-index:10000 !important;
        }
        #photo .el-select__input:focus{
            outline: none;
            border: 0;
            box-shadow: none;
        }
        .required {
            margin-top:3px;
        }
        .item-left {
            float:left;
            width:48%;
        }
        .item-right {
            float:right;
            width:48%;
        }
        .shift-item {
            width:100%;
        }
        .el-select {
            width:100%;
        }
        .el-date-editor.el-input {
            margin-top:5px;
            width:100%;
        }
        .el-textarea {
            margin-bottom:0px;
            margin-top:5px;
        }
        .el-message {
            z-index:9999 !important;
        }
        .shift-item {
            display:flex;
            justify-content:space-between;
        }
        .item-attributes {
            flex:1;
            margin-left:15px;
        }
        .item-attributes:first-child{
            margin-left:0px;
        }
        .el-form-item {
            margin-bottom:5px;
        }
        .el-select {
            display:block;
        }
        .formload {
            background:url('/layouteditor/formload.png') no-repeat center;
            background-size:cover;
            height:500px;
        }
        .el-checkbox {
            display:block;
            clear:both;
            position:relative;
            top:5px;
        }
        .loadingcontent {
            height:500px;
            /*background:url('/img/loadingimg.png') no-repeat center;*/
            background-size:cover;
            background-color:white;
        }
        .hidecontent {
            display:block !important;
        }
        .lookresultbtn {
            position:absolute;
            right:10px;
            top:26px;
            cursor:pointer;
        }
        .lookresultbtn:hover{
            color:#108def;
        }
        .lookresultbtn.disabled{
            pointer-events:none;
        }
        .checkbox-content .el-checkbox{
            display:inline-block;
            line-height:25px;
            height:25px;
            clear:none;
            float:left;
        }
        .checkbox-content .el-radio{
            display:inline-block;
            line-height:25px;
            height:25px;
        }
        .checkbox-content{
            clear:both;
        }
       body #iframe{
                width: 100% !important;
    height: 100%!important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
        }
    </style>
</head>
<body>
    <div id="photo" class="photo1">
        <div class="DESKTOP uiContainerManager" id="vueapp" >
            <div class="DESKTOP uiModal--medium uiModal forceModal open active" style="z-index: 1;">
                <div class="modal-glass slds-backdrop fadein slds-backdrop--open" style="opacity: 1;"></div>
                <div class="panel slds-modal slds-fade-in-open">
                    <div class="modal-container slds-modal__container">
                        <div class="modal-header slds-modal__header">
                            <h2 v-show="formload" class="title slds-text-heading--medium">新建</h2>
                            <h2 style="display:none;"  :class="{'hidecontent':!formload}"class="title slds-text-heading--medium">新建{{data.localizedTitle}}</h2>
                            <button class="slds-button slds-modal__close closeIcon slds-button_icon-bare slds-button_icon-inverse" type="button" title="关闭此窗口" id="closeds">
                                <span>
                                    <span style="font-size: 34px;">×</span>
                                </span>
                                <span class="slds-assistive-text">关闭此窗口</span>
                            </button>
                        </div>
                        <div class="loadingcontent" v-show="formload"></div>
                        <div v-show="!formload" style="display:none;" class="modal-body scrollable slds-modal__content slds-p-around--medium">
                            <el-form :model="list" ref="ruleForm" class="demo-ruleForm">
                            <div v-for="section in data.sections">
                            <div class="shift-body-titme" ><span>{{section.title}}</span></div>
                            <div class="shift-body-main">
                               <div class="shift-item" v-for="rows in section.rows">
                                   <div class="item-attributes" v-for="attributes in rows.attributes">
                                        <span class="required" v-if="attributes.attributes.required">*</span>
                                        <span class="shift-name-title">{{attributes.label}}</span>
                                        <el-form-item  
                                            v-if="attributes.attributes.type=='S'&&attributes.attributes.maxlength!=0" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                  { min: 1, max: attributes.attributes.maxlength, message: '长度在 1 到 '+attributes.attributes.maxlength+' 个字符', trigger: 'blur' },
                                                ]"
                                            >
                                            <el-autocomplete style="width:100%;" class="inline-input save-checking-input"
                                                        :disabled="attributes.attributes.readonly"
                                                        :class='{"save-checking-input":attributes.attributes.required}'
                                                        v-model="list[attributes.targetValue]"
                                                        :fetch-suggestions="function(queryString,cb){queryUnit(queryString,cb,data.objectTypeCode,attributes.targetValue)}"
                                                        placeholder="请输入内容">
                                       </el-autocomplete>
                                        </el-form-item>

                                       <el-form-item  
                                            v-if="attributes.attributes.type=='S'&&attributes.attributes.maxlength==0" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                 ]"
                                            >
                                            <el-autocomplete style="width:100%;" class="inline-input save-checking-input"
                                                        :disabled="attributes.attributes.readonly"
                                                        :class='{"save-checking-input":attributes.attributes.required}'
                                                         v-model="list[attributes.targetValue]"
                                                         :fetch-suggestions="function(queryString,cb){queryUnit(queryString,cb,data.objectTypeCode,attributes.targetValue)}"
                                                         placeholder="请输入内容">
                                       </el-autocomplete>
                                        </el-form-item>
                                       <el-form-item  
                                            v-if="attributes.attributes.type=='H'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-input 
                                            :disabled="attributes.attributes.readonly"
                                            :class='{"save-checking-input":attributes.attributes.required}'
                                             v-model="list[attributes.targetValue]"></el-input> 
                                        </el-form-item>
                                       <el-form-item  
                                            v-if="attributes.attributes.type=='E'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                  { type: 'email', message: '请输入正确的邮箱地址', trigger: ['blur','change' ]},
                                                ]"
                                            >
                                            <el-input 
                                            :disabled="attributes.attributes.readonly"
                                            :class='{"save-checking-input":attributes.attributes.required}'
                                             v-model="list[attributes.targetValue]"></el-input> 
                                        </el-form-item>
                                        <el-form-item  
                                            v-if="attributes.attributes.type=='N'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                  { validator:numberrule, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-input
                                                :disabled="attributes.attributes.readonly"
                                                :class='{"save-checking-input":attributes.attributes.required}'
                                                 v-model="list[attributes.targetValue]">
                                            </el-input> 
                                        </el-form-item>
                                       <el-form-item  
                                            v-if="attributes.attributes.type=='J'||attributes.attributes.type=='X'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请输入'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-input 
                                                :disabled="attributes.attributes.readonly"
                                                type="textarea"
                                                :rows="2"
                                                :class='{"save-checking-input":attributes.attributes.required}'
                                                 v-model="list[attributes.targetValue]">
                                            </el-input> 
                                        </el-form-item>
                                       <el-form-item style="clear:both;" v-if="attributes.attributes.type=='Z'||attributes.attributes.type=='z'">
                                           <div class="text_editor" :name="attributes.targetValue" :id="'text_'+attributes.targetValue"></div>
                                       </el-form-item>
                                        <el-form-item  
                                            v-if="attributes.attributes.type=='D'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-date-picker
                                              :disabled="attributes.attributes.readonly"
                                              :class='{"save-checking-input":attributes.attributes.required}'
                                              v-model="list[attributes.targetValue]"
                                              value-format="yyyy-MM-dd"
                                              type="date"
                                              placeholder="选择日期">
                                            </el-date-picker>
                                        </el-form-item>
                                       <el-form-item  
                                            v-if="attributes.attributes.type=='F'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-date-picker
                                            :disabled="attributes.attributes.readonly"
                                              :class='{"save-checking-input":attributes.attributes.required}'
                                              v-model="list[attributes.targetValue]"
                                              value-format="yyyy-MM-dd HH:mm:ss"
                                              type="datetime"
                                              placeholder="选择时间">
                                            </el-date-picker>
                                        </el-form-item>
                                       <el-form-item  
                                            v-if="attributes.attributes.type=='Year'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-date-picker
                                            :disabled="attributes.attributes.readonly"
                                              :class='{"save-checking-input":attributes.attributes.required}'
                                              v-model="list[attributes.targetValue]"
                                              value-format="yyyy"
                                              type="year"
                                              placeholder="选择年份">
                                            </el-date-picker>
                                        </el-form-item>

                                       <!--<el-form-item  
                                            v-if="attributes.attributes.type=='Month'" 
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'blur' },
                                                ]"
                                            >
                                            <el-date-picker
                                            :disabled="attributes.attributes.readonly"
                                              :class='{"save-checking-input":attributes.attributes.required}'
                                              v-model="list[attributes.targetValue]"
                                              value-format="MM"
                                              type="month"
                                              placeholder="选择月份">
                                            </el-date-picker>
                                        </el-form-item>-->
                                       <el-form-item v-if="attributes.attributes.type=='Month'"
                                                     :prop="attributes.targetValue"
                                                     :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'change' },
                                                ]">
                                           <el-select 
                                                      filterable
                                                      :disabled="attributes.attributes.readonly"
                                                      :class='{"save-checking-input":attributes.attributes.required}'
                                                      v-model="list[attributes.targetValue]" placeholder="请选择">
                                               <el-option key="无"
                                                          label="无"
                                                          value="">
                                               </el-option>
                                               <el-option v-for="i in 12"
                                                          :key="i"
                                                          :label="i+'月'"
                                                          :value="i">
                                               </el-option>
                                           </el-select>
                                       </el-form-item>
                                       <!--<el-form-item  
                                            v-if="attributes.attributes.type=='L'||attributes.attributes.type=='DT'||attributes.attributes.type=='LT'"
                                                     class="checkbox-content"
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'change' },
                                                ]"
                                            >
                                           <el-checkbox-group v-toarray="{name:attributes.targetValue,that:that}" v-model="list[attributes.targetValue]">
                                               <el-checkbox 
                                                            v-for="item in select[attributes.targetValue].values"
                                                            :label="item.value">{{item.label}}
                                               </el-checkbox>
                                           </el-checkbox-group>
                                        </el-form-item>
                                       <el-form-item  
                                                     class="checkbox-content"
                                            v-if="attributes.attributes.type=='L'||attributes.attributes.type=='DT'||attributes.attributes.type=='LT'"
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'change' },
                                                ]"
                                            >
                                           <el-radio-group v-model="list[attributes.targetValue]">
                                               <el-radio v-for="item in select[attributes.targetValue].values"
                                                            :label="item.value">{{item.label}}</el-radio>
                                           </el-radio-group>
                                        </el-form-item>-->
                                        <el-form-item  
                                            v-if="attributes.attributes.type=='L'||attributes.attributes.type=='DT'||attributes.attributes.type=='LT'"
                                            :prop="attributes.targetValue"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'change' },
                                                ]"
                                            >
                                            <el-select
                                                       filterable
                                            @change="function(val){Controllerchange(val,attributes.targetValue,picklistFieldMap[attributes.targetValue])}"
                                            v-if="JSON.stringify(select[attributes.targetValue].controllerValues)=='{}'"
                                            :disabled="attributes.attributes.readonly"
                                            :class='{"save-checking-input":attributes.attributes.required}'                                           
                                            v-model="list[attributes.targetValue]" placeholder="请选择">
                                                <el-option
                                                           key="无"
                                                           label="无"
                                                           value="">
                                                </el-option>
                                                <el-option
                                                  v-for="item in select[attributes.targetValue].values"
                                                  :key="item.value"
                                                  :label="item.label"
                                                  :value="item.value">
                                                </el-option>
                                            </el-select> 
                                            <el-select
                                                       filterable
                                            @change="function(val){Controllerchange(val,attributes.targetValue,picklistFieldMap[attributes.targetValue])}"
                                            v-if="JSON.stringify(select[attributes.targetValue].controllerValues)!='{}'"
                                            :disabled="attributes.attributes.readonly"
                                            :class='{"save-checking-input":attributes.attributes.required}'                                           
                                            v-model="list[attributes.targetValue]" placeholder="请选择">
                                                <el-option key="无"
                                                           label="无"
                                                           value="">
                                                </el-option>
                                                <el-option
                                                  v-for="item in select[attributes.targetValue].values"
                                                  v-show="item.show"
                                                  :key="item.value"
                                                  :label="item.label"
                                                  :value="item.value">
                                                </el-option>
                                            </el-select> 
                                        </el-form-item>
                                       <el-form-item
                                            v-if="attributes.attributes.type=='O'||attributes.attributes.type=='Y'||attributes.attributes.type=='U'||attributes.attributes.type=='Y_MD'" 
                                            :prop="attributes.targetValue+2"
                                            :rules="[
                                                  { required: attributes.attributes.required, message: '请选择'+attributes.label, trigger: 'change' },
                                                ]"
                                            >
                                           <el-select 
                                                  :disabled="attributes.attributes.readonly"
                                                  @change="function(val){lookupchange(val,attributes.targetValue,attributes.attributes)}"
                                                  :class='{"save-checking-input":attributes.attributes.required}'
                                                  v-model="list[attributes.targetValue].Id"
                                                  filterable
                                                  remote
                                                  @visible-change="getlookup(attributes.attributes.referencedEntityObjectTypeCode,attributes.localId)"
                                                  :remote-method="function(query){searchlookup(query,attributes.attributes.referencedEntityObjectTypeCode,attributes.localId)}"
                                                  placeholder="请选择">
                                           <el-option v-for="item in search[attributes.localId]"
                                                      :key="item.ID"
                                                      :label="item.Name"
                                                      :value="item.ID">
                                           </el-option>
                                       </el-select> 
                                           <div @click="openslookup(attributes.targetValue,attributes.attributes.sObjectType)" :class="{'disabled':attributes.attributes.readonly}" class="lookresultbtn">
                                               <i class="el-icon-search"></i>
                                           </div>
                                           <!--<div @click="openslookup(attributes.targetValue,30020)" class="lookresultbtn" v-if="attributes.attributes.sObjectType==30020">
                                               <i class="el-icon-search"></i>
                                           </div>
                                           <div @click="openslookup(attributes.targetValue,8)" class="lookresultbtn" v-if="attributes.attributes.sObjectType==8">
                                               <i class="el-icon-search"></i>
                                           </div>
                                           <div @click="openslookup(attributes.targetValue,10)" class="lookresultbtn" v-if="attributes.attributes.sObjectType==10">
                                               <i class="el-icon-search"></i>
                                           </div>-->
                                        </el-form-item>
                                           <el-checkbox
                                            :disabled="attributes.attributes.readonly"
                                            v-if="attributes.attributes.type=='MC'||attributes.attributes.type=='B'"
                                           v-model="list[attributes.targetValue]">
                                           </el-checkbox>
                                   </div>
                                   <div class="clear"></div>
                               </div>
                        </div>
                        </div>
                        </el-form>
                     </div>
                        <div class="modal-footer slds-modal__footer">
                            <div data-aura-rendered-by="9549:0" class="forceModalActionContainer--footerAction forceModalActionContainer">
                                <button style="margin-left:10px;float:right;display:none" 
                                    v-for="(headerActions,index) in data.headerActions"
                                    @click="headerFunction(headerActions.devNameOrId)" 
                                    class="slds-button slds-button--neutral uiButton forceActionButton" 
                                    :class="{
                                        'hidecontent':!formload,
                                        'uiButton--brand':index==0,
                                        'save-checking':headerActions.requires
                                    }"
                                    type="button">
                                    <span class="label bBody">{{headerActions.title}}</span> 
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    </script>
    <script src="/js/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/CommonUtils.js"></script>
    <script type="text/javascript" src="/element/vue.js"></script>
    <script type="text/javascript" src="/element/element.js"></script>
    <script type="text/javascript" src="/element/vue-resource.js"></script>
    <script>


        var vum = new Vue({
            el: '#vueapp',
            data(){
                return {
                    that:this,
                    objectTypeCode:'',
                    formload:true,
                    data:{},
                    list: {
                    },
                    attributes:{},
                    queryUnitlist:{},
                    //rules: {
                    //    text: [{
                    //        validator: function (rule, value, callback) {
                    //            console.log(rule)
                    //            console.log(value)
                    //            if (!value) {
                    //                return callback(new Error('年龄不能为空'));
                    //            }
                    //        }, trigger: 'blur'
                    //    }]
                    //},
                    select: {
                    },
                    search: {
                    },
                    numberrule: function (rule, value, callback) {
                        if (value && !/^(-?\d+)(\.\d+)?$/.test(value)) {
                            callback(new Error('请输入数字'));
                        } else {
                            callback();
                        }
                    },
                    picklistFieldMap: {

                    }
                }
            },
            beforeCreate: function () {
                this.that = this
            },
            mounted: function () {
                this.formload = false
            },
            directives: {
                toarray: {
                    bind: function (el, binding, vnode) {
                        var data = binding.value.that.list[binding.value.name].split(',')
                        binding.value.that.list[binding.value.name] = data
                    }
                }
            },
            created: function () {
                this.getlayout()

                //this.data = window.data
                //this.getselect()

                //this.data = window.data
                
                //for (var i = 0; i < this.data.section.length; i++) {
                //    var section = this.data.section[i]
                //    for (var j = 0; j < section.rows.length; j++) {
                //        var rows = section.rows[j]
                //        for (var k = 0; k < rows.attributes.length; k++) {
                //            var attributes = rows.attributes[k]
                //            if (attributes.type == 'obj') {
                //                this.list.push('')
                //            }



                //        }
                //    }  
                //}
                //this.getData()
            },
            methods: {
                Controllerchange: function (val, Controller, Dependents) {
                    if (Dependents) {
                        for (var m = 0; m < Dependents.length; m++) {
                            var Dependent = Dependents[m]
                            var listDependent = false
                            for (var i = 0; i < this.select[Dependent].values.length; i++) {
                                var item = this.select[Dependent].values[i]
                                item.show = false
                                //console.log(item)
                                for (var j = 0; j < item.validFor.length; j++) {
                                    var res = item.validFor[j]
                                    if (res == this.select[Dependent].controllerValues[val]) {

                                        item.show = true
                                        if (this.list[Dependent] == item.value) {
                                            listDependent = true
                                        }
                                    }
                                }
                            }
                            if (listDependent == false) {
                                this.list[Dependent] = ''
                            }
                        }
                    }
                },
                getpicklistvalues: function (objectTypeCode) {
                    var that = this
                    ajaxMethodGetAsyncData('layout.picklistvalues.get', {
                        objectTypeCode: objectTypeCode
                    }, false, function (data) {
                        that.select = data.actions[0].returnValue.picklistFieldValues
                        for (var i = 0; i < data.actions[0].returnValue.picklistFieldMap.length; i++) {
                            var item = data.actions[0].returnValue.picklistFieldMap[i]
                            if (!that.picklistFieldMap[item.ControllerName]) {
                                that.picklistFieldMap[item.ControllerName] = []
                            }
                            that.picklistFieldMap[item.ControllerName].push(item.DependentName)
                            that.Controllerchange(that.list[item.ControllerName], item.ControllerName, that.picklistFieldMap[item.ControllerName])
                        }
                    })
                },
                getlayout: function () {
                    var that = this
                    var entityName = getQueryString('entityName')
                    var type = getQueryString('type')
                    if (type == 'related' || type == 'relatedlist') {
                        var inContextOfRecordId = parent.getQueryString('id')
                        var inContextOfRecordId1 = parent.getQueryString('id')
                        if (getQueryString('inContextOfRecordId')) {
                            inContextOfRecordId = getQueryString('inContextOfRecordId')
                            if (inContextOfRecordId.indexOf(',') != -1) {
                                var inContextOfRecordId1 = inContextOfRecordId.split(',')[0]
                            } else {
                                var inContextOfRecordId1 = inContextOfRecordId
                            }
                        }
                        var message = {
                            "actions": [{
                                "params": {
                                    "record": null,
                                    "inContextOfRecordId": inContextOfRecordId1,
                                    "inContextOfComponent": "",
                                    "entityApiNameOrKeyPrefix": entityName,
                                    "mode": "CREATE",
                                    "layoutType": "FULL",
                                    "layoutOverride": "",
                                    "defaultFieldValues": {
                                    },
                                "changeRecordType": false,
                                "navigationLocation": "RELATED_LIST",
                                "navigationLocationId": "Contacts"
                                },
                                "storable": true
                                }]
                        }
                        var id = getQueryString('id')
                        if (id && id != '') {
                            message.actions[0].params.recordId = id
                            message.actions[0].params.mode = 'EDIT'
                        }
                        var relatedObjectAttributeName = getQueryString('relatedObjectAttributeName')
                        if (relatedObjectAttributeName && relatedObjectAttributeName != '') {
                            relatedObjectAttributeName = relatedObjectAttributeName.split(',')
                            if (inContextOfRecordId != 'undefinde' && inContextOfRecordId) {
                                inContextOfRecordId = inContextOfRecordId.split(',')
                                for (var i = 0; i < relatedObjectAttributeName.length; i++) {
                                    message.actions[0].params.defaultFieldValues[relatedObjectAttributeName[i]] = inContextOfRecordId[i]
                                }
                            }
                        }
                        
                    } else {
                        var message = {
                            "params": {
                                "recordId": "",
                                "record": null,
                                "inContextOfComponent": "",
                                "entityApiName": entityName,
                                "mode": "CREATE",
                                "layoutType": "FULL",
                                "navigationLocation": "DETAIL"
                            },
                            "storable": true
                        }
                        if (typeof parent.layoutId !='undefined') {
                            message.params.layoutId = parent.layoutId
                        }
                        var id = getQueryString('id')
                        if (id && id != '') {
                            message.params.recordId = id
                            message.params.mode = 'EDIT'
                        }
                    }
                    message = JSON.stringify(message)
                    var getlayoutdata = {
                        message: message
                    }
                    
                    ajaxMethodPostData('entity.config.get', getlayoutdata, function (data) {
                        that.data = data.actions[0].returnValue.componentDef
                        //that.select = data.context.picklistValuesMap
                        that.objectTypeCode = data.actions[0].returnValue.componentDef.objectTypeCode
                        for (var i = 0; i < that.data.lookupAttributes.length; i++) {
                            Vue.set(that.list, that.data.lookupAttributes[i].name, { Id: '', Name: '' })
                            Vue.set(that.search, that.data.lookupAttributes[i].name, [])
                        }
                        var id = getQueryString('id')
                        that.getData(data.actions[0].returnValue)
                        if (id && id != '') {
                            $('.title.slds-text-heading--medium').html('编辑' + that.data.localizedTitle)
                        } else {
                            //that.formload = false
                        }
                        that.getpicklistvalues(data.actions[0].returnValue.componentDef.objectTypeCode)
                        if (getQueryString('relatedObjectAttributeName')) {
                            for (var i = 0; i < getQueryString('relatedObjectAttributeName').split(',').length; i++) {
                                var name = getQueryString('relatedObjectAttributeName').split(',')[i]
                                var res = data.actions[0].returnValue.record[name]
                                var objectTypeCode = res.objectTypeCode
                                var id = res.Id
                                that.lookupchange(id,name,objectTypeCode, window.objectTypeCode)
                            }
                        }
                    })
                },
                openslookup: function (name, objtypecode) {
                    $('#changeDiv').show()
                    $('#iframe').show()
                    if (objtypecode == 30020) {
                        $('#iframe').attr('src', '/_ui/common/data/UserLookResult.html?name=' + name)
                    } else if (objtypecode == 10) {
                        $('#iframe').attr('src', '/_ui/common/data/deptchose_form.html?name=' + name)
                    } else if (objtypecode == 8) {
                        $('#iframe').attr('src', '/_ui/common/data/UserLookResult.html?name=' + name)
                    } else {
                        $('#iframe').attr('src', '/alert/lookupiframe.html?name=' + name + '&objtypecode=' + objtypecode )
                    }
                },
                headerFunction: function (name) {
                    var that = this
                    if (name == 'SaveEdit') {
                        function callback(data) {
                            if (data.status == 1) {
                                parent.success2('保存' + that.data.localizedTitle + '成功')
                                parent.$('#changeDiv').hide()
                                parent.$('.popup-mask').hide()
                                parent.$('#iframe').hide()
                                var type = getQueryString('type')
                                if (type == 'related') {
                                    var id = parent.getQueryString('id')
                                    parent.vueRelatedListBlock.getrelatedata(id)
                                    if (typeof parent.reRelatedList != 'undefined') {
                                        parent.reRelatedList()
                                    }
                                    if (parent.$('#detailview').length > 0) {
                                        var id = parent.getQueryString('id')
                                        parent.vue.getdata(id)
                                    }
                                }else if (type == 'iframenew') {
                                    parent.$('#childreniframe').attr('src', parent.$('#childreniframe').attr('src'))
                                } else if (type == 'relatedlist') {
                                    parent.getdata()
                                } else if (type == 'parentnewdata') {
                                    var f = getQueryString('f')
                                    parent[f]()
                                }
                                else {
                                    if (parent.$('#detailview').length > 0) {
                                        var id = parent.getQueryString('id')
                                        parent.vue.getdata(id)
                                    } else {
                                        parent.$('#datagrid').datagrid('reload')
                                    }
                                }
                            } else {
                                parent.error('保存失败')
                            }
                            parent.$('#datagrid').datagrid('reload')
                            //parent.$('#gridContainer').datagrid('reload')
                        }
                        this.saveData(callback)
                    } else if (name == 'SaveAndNew') {
                        function callback(data) {
                            if (data.status == 1) {
                                parent.success2('保存' + that.data.localizedTitle + '成功')
                                var entityName = getQueryString('entityName')
                                var src = '/layouteditor/add_layout.html?entityName=' + entityName
                                parent.$('#iframe').attr('src', src)
                            } else {
                                parent.error('保存失败')
                            }
                            //parent.$('#gridContainer').datagrid('reload')
                        }
                        this.saveData(callback)
                        
                    } else if (name == 'CancelEdit') {
                        //window.parent.document.getElementById("changeDiv").style.display = "none";
                        parent.$('#changeDiv').hide()
                        parent.$('.popup-mask').hide()
                        parent.$('#iframe').hide()
                    }
                },
                getData: function (data) {
                    this.list = JSON.parse(JSON.stringify(data.record))
                    this.attributes = JSON.parse(JSON.stringify(data.record))
                    var that = this
                    for (var item in data.record) {
                        if (data.record[item] == 'null') {
                            data.record[item] = null
                        }
                    }
                    for (item in that.search) {
                        if (item != 'searchname') {
                            var name = item
                            var ID = that.list[name].Id
                            var Name = that.list[name].Name
                            var newlist = {
                                ID: ID,
                                Name: Name
                            }
                            that.search[name].push(newlist)
                            Vue.set(that.list, name + 2, ID)
                        }
                    }
                    //that.formload = false
                },
                submitForm: function (formName, callback) {
                    var objectTypeCode = this.data.objectTypeCode

                    for (var i = 0; i < $('.text_editor').length; i++) {
                        var name = $('.text_editor').eq(i).attr('name')
                        var item = $('.text_editor').eq(i).attr('id')                      
                        vum.list[name] = $('#' + item).find('.w-e-text').html()
                    }

                    var d = this.list
                    //console.log(formName)
                    //console.log(this.$refs[formName].validate)
                    console.log(this.list)
                    this.$refs[formName].validate(function (valid) {
                        // console.log(123)
                        console.log(valid)

                        if (valid) {
                            $(".form-error").remove()
                            $(".form-error2").remove()
                            var id = getQueryString('id')
                            var messages = {
                                params: {
                                    recordRep: {
                                        objTypeCode: objectTypeCode,
                                        fields: d
                                    }
                                }
                            }
                            if (id != null) {
                                messages.params.recordRep.id = id
                            }

                            messages = JSON.stringify(messages)
                            var data = { message: messages };
                            //if (objectTypeCode == 30028) {
                            //    ajaxMethodPostData('employee.change.reward', data, callback)

                            //}
                            //if (objectTypeCode == 30055) {
                            //    ajaxMethodPostData('employee.change.unreward', data, callback)

                            //}
                            //else {
                            //}
                            ajaxMethodPostData('entity.saverecord', data, callback)

                        } else {
                            $(".form-error").remove()
                            $(".form-error2").remove()
                            $(".save-status").remove()
                            $(".modal-header").append('        <div class="form-error">检查此页面上的错误</div>'
                            + '<div class="form-error2">必须填写这些必填字段'
                            + '<span></span>'
                            + '</div>')
                            //$(".form-error2 span").html($(this).prev().html())
                            return false;
                        }
                    });
                },
                saveData: function (callback) {
                    this.submitForm('ruleForm',callback)
                },
                getlookup: function (Lktp, name) {
                    var that = this
                    var d = {}
                    d = {
                        Lktp: Lktp
                    }
                    ajaxMethodGetData('ui.entity.lookup', d, callback)
                    function callback(data) {
                        that.search[name] = data.listData
                        var id = getQueryString('id')
                        if (id != null) {
                            var ID = that.list[name].Id
                            var Name = that.list[name].Name
                            var newlist = {
                                ID: ID,
                                Name: Name
                            }
                            if (ID) {
                                if (JSON.stringify(that.search[name]).indexOf(JSON.stringify(newlist.ID)) == -1) {
                                    that.search[name].push(newlist)
                                }
                            }
                        }
                    }
                },
                searchlookup: function (query, Lktp, name) {
                    var that = this
                    var d = {}
                    d = {
                        Lktp: Lktp,
                        Lksrch: query
                    }
                    ajaxMethodGetData('ui.entity.lookup', d, callback)
                    function callback(data) {
                        that.search[name] = data.listData
                    }
                },
                lookupchange: function (val, data) {
                    Vue.set(this.list, data + 2, val)
                    var that = this
                    var attributes = that.attributes[data]
                    ajaxMethodGetData('entity.attributelookup.inputrequest', {
                        lookupObjectTypeCode: attributes.objectTypeCode,
                        ObjectTypeCode: that.objectTypeCode,
                        lookupAttributeName: data,
                        id: val
                    }, function (data) {
                        var res = data.actions[0].returnValue.changeValues
                        for (item in res) {
                            if (res[item] != null) {
                                if (res[item].Id) {
                                    that.list[item].Id = res[item].Id
                                    that.search[item].push({
                                        ID:res[item].Id,
                                        Name: res[item].Name
                                    })
                                } else {
                                    that.list[item]=res[item]
                                }
                            } else {
                                that.list[item]=''
                            }

                        }
                    })
                }
            }
        })
    </script>
    <script src="/wangEditor/wangEditor.min.js"></script>

    <script>
        $(document).ready(function () {
            var E = window.wangEditor
            var editoritems = {}
            for (var i = 0; i < $('.text_editor').length; i++) {
                var item = $('.text_editor').eq(i).attr('id')
                var name = $('.text_editor').eq(i).attr('name')
                editoritems[item] = new E('#' + item)
                editoritems[item].customConfig.uploadImgShowBase64 = true
                editoritems[item].create()
                $('#' + item).find('.w-e-text').html(vum.list[name])
            }
        })
        $('#closeds').click(function () {
            parent.$('#changeDiv').hide()
            parent.$('.popup-mask').hide()
            parent.$('#iframe').hide()
        })
    </script>
    <div id="changeDiv" style="width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; z-index: 9999;display:none;">
        <iframe id="iframe" style="width: 100%; height: 100%!important; position: fixed; top: 0; left: 0;"></iframe>
    </div>
</body>
</html>
